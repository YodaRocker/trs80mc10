0 CLS:CLEAR200:DIMZ,US,X,Y,A0,B0,A1,B1,B,A(50,50),S(100),T(4):GOSUB4100:GOTO30
3 POKEVC,28:RETURN
4 POKEVC,0:RETURN
5 US=USR((A1*256+B1)*65537):RETURN
6 US=USR((INT(A1/4)*256+INT(B1/4))*65536+INT(A2/4)*256+INT(B2/4)):RETURN
7 FORB=1TOLEN(M$):PRINTMID$(B$,(ASC(MID$(M$,B,1))-46)*2,2);:NEXT:RETURN
8 Z=PEEK(9)AND128:POKE49151,28+Z:POKE49151,156-Z:RETURN
30 CLS:B$="€€€»ª·‚µ‚·ˆ­ˆ— ¯Š±¨Ÿ¨¼ª‘€†€™€³€¦€¶€™ˆ›ª¯Š»¢»ˆ¿¢¾ ½ª®ª·¢¶ ®¢«‚¾ªºŠ»ª¾¨¼ªºˆ— µ «ª©¨¯ª¦¢¥ µ‚"
40 PRINT@6+32*6,"THE MOUNDS OF CTEIA":GOSUB4000
70 D=2:XC=1:YC=1:RR=5
80 SP=0
90 CLS0:GOSUB3:PRINT@480,;:IFD=1THENM$="N":GOSUB7
100 IFD=2THENM$="E":GOSUB7
110 IFD=3THENM$="S":GOSUB7
120 IFD=4THENM$="W":GOSUB7
130 PRINT@480+4,;:M$=MID$(STR$(XC),2)+"/"+MID$(STR$(YC),2):GOSUB7
140 R=RR:GOSUB1000
150 IFSP<>0THEN190
160 XX=XC:YY=YC:GOSUB2500:IFS=0THEN190
170 SP=1:ONSGOTO3000,3200,3400,3600
190 PRINT@480+16,;:M$="MOVE":GOSUB7
200 A$=INKEY$:IFA$="A"THEN270
220 IFA$="S"THEN290
230 IFA$="W"THEN310
240 IFA$="T"THEN410
250 IFA$="Z"THEN330
260 GOTO200
270 D=D-1:IFD=0THEND=4
280 GOTO90
290 D=D+1:IFD=5THEND=1
300 GOTO90
310 XX=XC:YY=YC:GOSUB2500:P=D:IFT(D)<>0THEN350
320 GOSUB8:GOTO200
330 XX=XC:YY=YC:GOSUB2500:P=D-2:M$=MID$(STR$(P),2):GOSUB7:IFP<1THENP=P+4
340 IFT(P)=0THEN320
350 SP=0
360 IFP=1THENYC=YC-1
370 IFP=2THENXC=XC+1
380 IFP=3THENYC=YC+1
390 IFP=4THENXC=XC-1
400 GOTO90
410 CLS0:GOSUB4:CLS
420 INPUT"TELEPORT TO (X,Y)";XC,YC
430 CLS0:GOSUB3:GOTO90
1000 R=0:XX=XC:YY=YC:E1=-64:CX=0:CY=79:TR=105
1030 GOSUB2500
1040 IFT(D)=1THEN1060
1050 GOSUB2000:GOTO1080
1060 R=R+1:IFR<RRTHENGOSUB1500:GOTO1030
1070 R=R-1:GOSUB1600
1080 E2=CX-2^(6-R)
1090 IFR=0THENRETURN
1100 GOSUB1700:SG=1:GOSUB1200:GOSUB1800:SG=-1:GOSUB1200:RETURN
1200 E=0:P=D-SG:IFP<1THENP=4
1210 IFP>4THENP=1
1220 GOSUB2500
1230 IFT(P)=1THENE=E+1:GOTO1280
1240 GOSUB2200
1250 IFE=0THEN1270
1260 GOSUB1700:E1=X2:GOSUB1300:GOSUB1800
1270 E=0:E2=CX-2^(7-R)
1280 R=R-1:GOSUB1600:IFCX-2^(6-R)>E1THEN1220
1290 IFE=0THENRETURN
1300 GOSUB1550
1310 GOSUB1500:R=R+1
1320 IFR=RRTHEN1420
1330 GOSUB2500
1340 IFT(D)=1THEN1400
1350 GOSUB1900:GOSUB1650:GOSUB2100
1360 IFX1=E1THEN1390
1370 GOSUB1700:E2=X1
1380 GOSUB1200:GOSUB1800
1390 GOSUB1950:E1=X2
1400 IFE1<>E2THEN1310
1410 RETURN
1420 R=R-1:GOSUB1600:GOSUB1650
1445 IFCX<=E1THENRETURN
1450 GOTO1200
1500 V=D
1510 IFV=1THENYY=YY-1
1520 IFV=2THENXX=XX+1
1530 IFV=3THENYY=YY+1
1540 IFV=4THENXX=XX-1
1545 RETURN
1550 V=D-SG
1560 IFV<1THENV=4
1570 IFV>4THENV=1
1580 GOTO1510
1600 V=D-2
1610 IFV<1THENV=V+4
1620 IFV>4THENV=V-4
1630 GOTO1510
1650 CX=CX-2^(7-R)
1660 IFCX>E2THENCX=E2
1670 RETURN
1700 ST=ST+1:S(ST)=CX:ST=ST+1:S(ST)=XX:ST=ST+1:S(ST)=YY:ST=ST+1:S(ST)=R:ST=ST+1:S(ST)=E1:ST=ST+1:S(ST)=E2
1760 ST=ST+1:S(ST)=X2:RETURN
1800 X2=S(ST):ST=ST-1:E2=S(ST):ST=ST-1:E1=S(ST):ST=ST-1:R=S(ST):ST=ST-1:YY=S(ST):ST=ST-1:XX=S(ST):ST=ST-1
1860 CX=S(ST):ST=ST-1:RETURN
1900 ST=ST+1:S(ST)=CX
1910 RETURN
1950 CX=S(ST):ST=ST-1
1960 RETURN
2000 L=2^(6-R):L2=L/4:X1=CX-L:X2=CX+L:X3=X1+L2:X4=X2-L2:Y1=CY-L:Y2=CY+L:Y3=Y1+L2
2030 A1=X1+TR:B1=Y1:A2=X2+TR:B2=Y1:GOSUB6:A1=A2:B1=B2:A2=X2+TR:B2=Y2:GOSUB6
2031 A1=A2:B1=B2:A2=X1+TR:B2=Y2:GOSUB6:A1=A2:B1=B2:A2=X1+TR:B2=Y1:GOSUB6
2040 IFT(D)<>2THENRETURN
2050 A1=X3+TR:B1=Y2:A2=X3+TR:B2=Y3:GOSUB6:A1=A2:B1=B2:A2=X4+TR:B2=Y3:GOSUB6
2051 A1=A2:B1=B2:A2=X4+TR:B2=Y2:GOSUB6:RETURN
2100 L=2^(6-R):L2=L/4:X1=CX-L:X2=CX+L:X3=X1+L2:X4=X2-L2:Y1=CY-L:Y2=CY+L:Y3=Y1+L2
2120 IFX1<E1THENX1=E1
2125 IFX2>E2THENX2=E2
2130 A1=SG*X1+TR:B1=Y1:A2=SG*X2+TR:B2=Y1:GOSUB6:A1=A2:B1=B2:A2=SG*X2+TR:B2=Y2:GOSUB6
2131 A1=A2:B1=B2:A2=SG*X1+TR:B2=Y2:GOSUB6:A1=A2:B1=B2:A2=SG*X1+TR:B2=Y1:GOSUB6
2140 IFT(D)<>2THENRETURN
2150 IFX4<E1THENRETURN
2155 IFX3>E2THENRETURN
2160 IFX3<E1THENX3=E1
2170 IFX4>E2THENX4=E2
2180 A1=SG*X3+TR:B1=Y2:A2=SG*X3+TR:B2=Y3:GOSUB6:A1=A2:B1=B2:A2=SG*X4+TR:B2=Y3:GOSUB6
2181 A1=A2:B1=B2:A2=SG*X4+TR:B2=Y2:GOSUB6:RETURN
2200 L=2^(6-R):L2=L/4:L3=2*L:X1=CX-L3:X2=CX-L:Y1=CY-L3:Y2=CY-L:Y3=CY+L:Y4=CY+L3
2220 IFE1>X1THENX1=E1:Y1=CY-CX+E1:Y4=CY+CX-E1
2230 A1=SG*X1+TR:B1=Y1:A2=SG*X2+TR:B2=Y2:GOSUB6:A1=A2:B1=B2:A2=SG*X2+TR:B2=Y3:GOSUB6
2231 A1=A2:B1=B2:A2=SG*X1+TR:B2=Y4:GOSUB6:A1=A2:B1=B2:A2=SG*X1+TR:B2=Y1:GOSUB6
2240 IFT(P)<>2THENRETURN
2245 X3=CX-L3+L2:X4=CX-L-L2:Y5=CY-L3+3*L2:Y6=Y2+L2:Y7=Y3+L2:Y8=CY+L3-L2
2260 IFE1>X4THENRETURN
2270 IFE1>X3THENY5=Y1+2*L2:Y8=Y4:X3=E1
2280 A1=SG*X3+TR:B1=Y8:A2=SG*X3+TR:B2=Y5:GOSUB6:A1=A2:B1=B2:A2=SG*X4+TR:B2=Y6:GOSUB6
2281 A1=A2:B1=B2:A2=SG*X4+TR:B2=Y7:GOSUB6:RETURN
2500 T=A(XX,YY):IFT<0THENT=T+65536
2520 S=INT(T/4096):T=T-S*4096:T(1)=INT(T/512):T=T-T(1)*512:T(2)=INT(T/64):T=T-T(2)*64:T(3)=INT(T/8):T(4)=T-T(3)*8:RETURN
3000 CLS0:GOSUB4:CLS
3010 PRINT"THOU HAST THE TEMERITY TO ENTER":PRINT"MY DEMESNE?, ";:SOUND1,20:PRINT"THEN SUFFER"
3030 PRINT"THY FOUL CONSEQUENCE OF FOLLY!":PRINT:PRINT"HIT A KEY"
3040 A$=INKEY$:IFA$=""THEN3040
3050 CLS0:GOSUB3:XC=2:YC=2:GOTO90
4000 READMX,MY
4040 FORI=1TOMY:FORJ=1TOMX:READA(J,I):NEXT:NEXT:RETURN
4100 VI=16384:VC=49151
4200 DATALNPDALMMABABNNLLNMMMJAMKCCAJCFADHPAALLHAAALLEANAMLCCAJCFADHPAALMHAAALMFANNNGBBCDHCEPJHMOJHNLJGNGJHNMINDCJG
4201 DATAMKJBMMCHCIJLLLJHMKJGMOJLNHJHMOBGJANLCKABEANANMCKABFABBCFOANGNMNHNLNLNGNHNMNGMLNLLMNHMLCANAFPHOOMOCNMMKNNNI
4202 DATAJGNJMGKLDNIGIAMAFFEEEEMLFFMBFFCEPIHEAANICEABEEIKIAJHNKIGCADNNLNIIJAAIKEAIEEBNNNINONINGNKOKAAOHAADJEPJHMOJH
4203 DATANLJGNHJHNMINMAJGMLJBMNCHLGJLLMJHMLJGMOJLNGJHMOBGJANLCKABEANANMCKABFABBCFOANGNMNHNLNLNHNHNMNGMKNLLLNHMKCANA
4204 Z=32768:FORX=0TO3:READA$:GOSUB4205:NEXTX:Z=16917:A$="HOIAAA"
4205 FORY=1TOLEN(A$)/2:POKEZ,(ASC(MID$(A$,2*Y-1,1))-65)*16+ASC(MID$(A$,2*Y,1))-65:Z=Z+1:NEXTY:RETURN
5100 DATA10,10
5110 DATA72,65,73,73,137,66,73,73,9,0,520,144,586,585,585,9,576,593,513,0,584,1097,585,585,585,585,9,1096,9,0
5140 DATA584,577,585,593,585,577,513,584,521,0,520,72,513,8,584,9,136,586,521,0,576,577,65,529,584,585,513,584,521,0
5170 DATA64,73,9,1032,584,585,9,576,513,0,128,586,521,528,584,585,585,73,9,0,64,577,577,1089,585,585,585,521,520,0
5200 DATA64,65,4161,65,577,577,577,641,514,0
