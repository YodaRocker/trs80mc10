REM COLOSSAL CAVE 101
REM ORIGINAL DEVELOPMENT BY WILLIE CROWTHER, 1975
REM GREATLY EXPANDED BY DON WOODS, 1976
REM STREAMLINED WITH RANDOM MAPS AND NEW PUZZLES BY JEFFREY HENNING, 2017
REM USING ABC ADVENTURE ENGINE V1.0
REM USE IT TO WRITE YOUR OWN ADVENTURES!

GOSUB INIT

REM NO NEED TO CUSTOMIZE BELOW UNLESS YOU WANT TO ADD NEW FUNCTIONALITY

REM COLOR CONSTANTS
BLACK=0
WHITE=1
GRAY=2
DARKGRAY=3
RED=4
DARKRED=5
BROWN=6
ORANGE=7
YELLOW=8
GREEN=9
DARKGREEN=10
CYAN=11
BLUE=12
DARKBLUE=13
MAGENTA=14
PURPLE=15

DISPLAY 4
LAYER OPEN 0,128,128,0
CLS
FONT 0
COLOR CYAN
KEYBOARD ON

PERSIST HIGHSCORE

REM LOCN$    NAME    PATH    DESC
NAME = 1
PATH = 2
DESC = 3
DIM LOCN$(LOCNMAX, DESC)
FOR L=1 TO LOCNMAX
   READ LOCN$(L, NAME), LOCN$(L, PATH), LOCN$(L, DESC)
NEXT L

REM ACTN$    NAME    TRNS    MSSG
TRNS = 2
MSSG = 3
DIM ACTN$(90, MSSG)
REPEAT
   READ S$
   IF S$<>"[" THEN
      A = ASC(S$)
      ACTN$(A, NAME) = S$
      READ ACTN$(A, TRNS), ACTN$(A, MSSG)
   END IF
UNTIL S$="["

REM OBJT$    NAME    KIND    DESC
KIND = 2
DIM OBJT$(90, DESC)
REM OBJT    XSPOT YSPOT FOUND SOLVED
XSPOT = 1
YSPOT = 2
FOUND = 3
SOLVED = 4
SOLUTION = 5
DIM OBJT(90, SOLVED)
REPEAT
   READ S$
   J = ASC(S$)
   IF S$<>"[" THEN
      OBJT$(J, NAME) = S$
      READ OBJT$(J, KIND), OBJT$(J, DESC)
      IF OBJT$(J, KIND)="!" THEN LAMP = J
   END IF
UNTIL S$="["
REM XSPOT SPECIAL VALUES:
ONYOU = -1
REMOVED = -2

REM CMND$ XFRMOBJT XFRMLOCN MSSG
XFRMOBJT=1
XFRMLOCN=2
DIM CMND$(CMNDMAX, MSSG)
FOR K = 1 TO CMNDMAX
    READ A$, O$, L$, CMND$(K, XFRMOBJT), CMND$(K, XFRMLOCN), CMND$(K, MSSG)
    CMNDLIST$ = CMNDLIST$ + LEFT$(A$+"*",1) + LEFT$(O$+"*",1) + LEFT$(L$+"***",3) + " " 
    REM NOTE IF THIS OBJECT WILL SOLVE A PUZZLE
    IF LEN(CMND$(K, XFRMLOCN))>0 THEN OBJT(ASC(O$), SOLVED) = SOLUTION
NEXT K
REM PRINT "("+CMND$(CMNDMAX, MSSG)+")"

REM CREATE BACKGROUND MAP
DIM MAP(XMAX, YMAX)
REM NEGATIVE LOCATION INDICATES IT HASN’T BEEN VISITED YET
FOR X = 1 TO XMAX
   FOR Y = 1 TO YMAX
      MAP(X, Y) = -1
   NEXT Y
NEXT X
FOR X = 1 TO XMAX
   MAP(X,1) = -2
   MAP(X,YMAX) = -3
NEXT X
FOR Y=1 TO YMAX
   MAP(1,Y) = -4
   MAP(XMAX,Y) = -5
NEXT Y

REM CREATE RANDOM MAP
REM SHUFFLE LOCATIONS
DIM DECK(LOCNMAX)
FOR L=1 TO LOCNMAX
    DECK(L) = L
NEXT L
RANDOMIZE TIMER
FOR L=1 TO LOCNMAX
    K = INT(RND*LOCNMAX+1)
    T = DECK(L)
    DECK(L) = DECK(K)
    DECK(K) = T
NEXT L
REM LOAD LOCATIONS AND PLACE OBJECTS
L=1
FOR X=2 TO XMAX-1
   FOR Y=2 TO YMAX-1
      IF DECK(L)<5 THEN
         MAP(X,Y) = -5
      ELSE
         MAP(X,Y) = -DECK(L)
      END IF
      IF DECK(L)<27 THEN
         IF LEN(OBJT$(64+DECK(L), NAME))>0 THEN
            OBJT(64+DECK(L), XSPOT) = X
            OBJT(64+DECK(L), YSPOT) = Y
            OBJT(64+DECK(L), FOUND) = FALSE
         END IF
      END IF
      IF LOCN$(DECK(L), NAME)="ENT" THEN
         ENTRX = X
         ENTRY = Y
         CRNTX = X
         CRNTY = Y
         CRNTLOCN = DECK(L)
      END IF
      L = L+1
      IF L>LOCNMAX THEN
         X=XMAX
         Y=YMAX
      END IF
   NEXT Y
NEXT X   
REM PUT THE LAMP IN THE ENTRANCE
OBJT(LAMP,XSPOT) = ENTRX
OBJT(LAMP,YSPOT) = ENTRY

M$ = "WELCOME TO "+TITLE$+"!! SAY 'HELP' FOR INSTRUCTIONS."
GOSUB MESSAGE
PRINT

GOSUB DESCRIBE
GOSUB MESSAGE
DO
  GOSUB GETCOMMAND
LOOP

GETCOMMAND:
REM GET ACTION AND, IF NEEDED, OBJECT
LASTA$ = A$
PRINT
PRINT ">";
REPEAT
  A$=INKEY$
UNTIL "A"<=A$ AND A$<="Z"
A=ASC(A$)
PRINT ACTN$(A, NAME);
PRINT " ";
IF ACTN$(A, TRNS)="T" THEN
   REPEAT
      REPEAT
       O$=INKEY$
      UNTIL "A"<=O$ AND O$<="Z" OR O$=CHR$(13) OR O$=CHR$(8)
      O=ASC(O$)
   UNTIL OBJT(O, FOUND) OR O<32
   PRINT OBJT$(O,NAME);
   IF O<32 THEN
      PRINT
      PRINT "I DON'T UNDERSTAND."
      RETURN
   ELSE IF OBJT(O, XSPOT)<>CRNTX AND OBJT(O, YSPOT)<>CRNTY AND OBJT(O, XSPOT)<>ONYOU THEN
      PRINT
      PRINT "I SEE NO " + OBJT$(O, NAME) + " HERE."
      RETURN
   END IF
ELSE
   O$="*"
   O=0
END IF
PRINT

REM PRESET TO THE DEFAULT MESSAGE, IF NEEDED
M$ = ACTN$(A, MSSG)
OVERRIDE = FALSE

REM ROUTE TO ACTION
IF A$="A" THEN GOSUB ACTIONS
IF A$="B" THEN GOSUB BACK
IF A$="C" THEN GOSUB CLOSEOBJT
IF A$="D" THEN GOSUB DROP
IF A$="E" THEN GOSUB EAST
IF A$="F" THEN GOSUB FIGHT
IF A$="G" THEN GOSUB GIVE
IF A$="H" THEN GOSUB HELP
IF A$="I" THEN GOSUB INVENTORY
IF A$="J" THEN GOSUB JUMP
IF A$="K" THEN GOSUB KICK
IF A$="L" THEN GOSUB LOOK
IF A$="M" THEN GOSUB MAP
IF A$="N" THEN GOSUB NORTH
IF A$="O" THEN GOSUB OPENOBJT
IF A$="P" THEN GOSUB POINTS
IF A$="Q" THEN GOSUB QUIT
IF A$="R" THEN GOSUB READOBJT
IF A$="S" THEN GOSUB SOUTH
IF A$="T" THEN GOSUB TAKE
IF A$="U" THEN GOSUB USE
IF A$="V" THEN GOSUB VERBOSE
IF A$="W" THEN GOSUB WEST
IF A$="X" THEN GOSUB XPLORE
IF A$="Y" THEN GOSUB YES
IF A$="Z" THEN GOSUB ZZZ

IF NOT OVERRIDE THEN GOSUB POSTPROCESS
IF LEN(M$)>0 THEN GOSUB MESSAGE
RETURN

ACTIONS:
GOSUB MESSAGE
FONT 1
FOR A = 65 TO 90
     IF LEN(ACTN$(A, NAME)) > 0 THEN M$ = M$ + LEFT$(ACTN$(A, NAME)+"          ",10)
     IF LEN(M$) = 30 THEN
        PRINT M$
        M$=""
     END IF
NEXT A
A = ASC(A$)
PRINT M$
M$=""
FONT 0
RETURN

BACK:
IF LASTA$="J" OR LASTA$="X" THEN
   M$ = "SORRY, BUT I NO LONGER SEEM TO REMEMBER HOW IT WAS YOU GOT HERE."
   OVERRIDE=TRUE
ELSE IF OBJT(LAMP, XSPOT) <> ONYOU THEN
  M$="IT IS NOW PITCH DARK. IF YOU PROCEED YOU WILL LIKELY FALL INTO A PIT."
  OVERRIDE=TRUE
ELSE
   NEXTX = LASTX
   NEXTY = LASTY
   GOSUB MOVE
END IF 
RETURN

CLOSEOBJT:
OVERRIDE=TRUE
IF OBJT$(O, KIND)="+" THEN
   OBJT$(O, KIND)="-"
   M$ = "IT IS NOW CLOSED."
   OVERRIDE=FALSE
ELSE IF OBJT$(O, KIND)="-" THEN
  M$ = "IT WAS ALREADY CLOSED."
END IF
RETURN

DROP:
IF OBJT(O, XSPOT) <> ONYOU THEN
   M$ = "YOU AREN’T CARRYING IT!"
   OVERRIDE=TRUE
ELSE
   M$ = "OK."
   OBJT(O, XSPOT) = CRNTX
   OBJT(O, YSPOT) = CRNTY
END IF
RETURN

EAST:
NEXTX=CRNTX+1
NEXTY=CRNTY
GOSUB TRYTOMOVE
RETURN

FIGHT:
REM ALL HANDLED BY COMMANDS
RETURN

GIVE:
T = INSTR(LOCN$(CRNTLOCN, DESC), "@")
IF OBJT(O, XSPOT) <> ONYOU THEN
   M$ = "YOU AREN’T EVEN CARRYING IT!"
   OVERRIDE=TRUE
ELSE IF T=0 THEN
   M$ = "THERE’S NO ONE HERE TO GIVE ANYTHING TO."
   OVERRIDE=TRUE
ELSE
   M$ = "YOU GIVE THE "+OBJT$(O, NAME)+" TO THE "+MID$(LOCN$(CRNTLOCN, DESC), T+1, INSTR(LOCN$(CRNTLOCN, DESC), " ", T)-T-1)+"."
   OBJT(O, XSPOT) = REMOVED   
END IF
RETURN

HELP:
REM ALL HANDLED BY COMMANDS
RETURN

INVENTORY:
GOSUB MESSAGE
T=FALSE
FOR J = 65 TO 90
   IF OBJT(J, XSPOT) = ONYOU THEN
     PRINT CHR$(J)+MID$(OBJT$(J, NAME),2,255)
     T=TRUE
   END IF
NEXT J
IF NOT T THEN PRINT "NOTHING"
RETURN

JUMP:
GOSUB MESSAGE
O=0
FOR J = 65 TO 90
   IF OBJT(J, XSPOT) = ONYOU AND J<> LAMP THEN
       O=J
    END IF
NEXT J
IF O>0 THEN
   M$ = "AS YOU JUMPED I'M AFRAID THAT YOU DROPPED THE " + OBJT$(O, NAME) + "!"
   GOSUB MESSAGE 
   OBJT(O, XSPOT) = CRNTX
   OBJT(O, YSPOT) = CRNTY   
END IF
O=0
GOSUB XPLORE
RETURN

KICK:
A$ = "F"
REM SYNONYM FOR FIGHT
REM ALL HANDLED BY COMMANDS
RETURN

LOOK:
GOSUB MESSAGE
GOSUB DESCRIBE
RETURN

MAP:
FONT 1
F=FALSE
D=9
LAYER OPEN 1,128,128,0
CLS
COLOR WHITE
BOX D,D TO XMAX*D+D,YMAX*D+D
FOR Y = 1 TO YMAX
   FOR X = 1 TO XMAX
      IF MAP(X,Y)<0 THEN
         REM DON'T DISPLAY
      ELSE 
            COLOR WHITE
            L = ABS(MAP(X,Y))
            REM PRINT LOCN$(L, NAME); 
            REM PRINT " ";
            IF INSTR(LOCN$(L, PATH),"N")=0 THEN LINE X*D,Y*D TO X*D+D,Y*D
            IF INSTR(LOCN$(L, PATH),"S")=0 THEN LINE X*D,Y*D+D TO X*D+D, Y*D+D
            IF INSTR(LOCN$(L, PATH),"W")=0 THEN LINE X*D,Y*D TO X*D,Y*D+D
            IF INSTR(LOCN$(L, PATH),"E")=0 THEN LINE X*D+D,Y*D TO X*D+D, Y*D+D
      END IF
      IF X = CRNTX AND Y = CRNTY THEN
         COLOR GREEN
         F=TRUE
      ELSE IF LOCN$(ABS(MAP(X,Y)), NAME) = "ENT" THEN
         COLOR BLUE
      ELSE IF LEN(LOCN$(ABS(MAP(X,Y)), PATH)) >4 AND MAP(X,Y)>0 THEN
         COLOR RED
      ELSE IF MAP(X,Y)>0 THEN
         COLOR GRAY
      END IF
      IF MAP(X,Y)>0 THEN
         BAR X*D+1, Y*D+1 TO X*D+D-1, Y*D+D-1
         IF LEN(LOCN$(ABS(MAP(X,Y)), PATH)) <=4 THEN
            FOR J = 65 TO 90
               IF OBJT(J, XSPOT) = X AND OBJT(J, YSPOT) = Y THEN
                  COLOR BLACK
                  TEXT X*D+3, Y*D+3, CHR$(J)
                  J=91
               END IF
            NEXT J
         ELSE
            COLOR BLACK
            TEXT X*D+3, Y*D+3, LEFT$(LOCN$(ABS(MAP(X,Y)), NAME),1)
         END IF
      END IF
   NEXT X
   PRINT
NEXT Y
WHILE INKEY$=""
WEND
LAYER CLOSE 1
LAYER OPEN 0,128,128,0
CLS
COLOR CYAN
FONT 0
GOSUB DESCRIBE
RETURN

NORTH:
NEXTX=CRNTX
NEXTY=CRNTY-1
GOSUB TRYTOMOVE
RETURN

OPENOBJT:
OVERRIDE=TRUE
IF OBJT$(O, KIND)="-" THEN
   OBJT$(O, KIND)="+"
   M$ = "IT IS NOW OPENED."
   OVERRIDE=FALSE
ELSE IF OBJT$(O, KIND)="+" THEN
  M$ = "IT WAS ALREADY OPENED."
END IF
RETURN

POINTS:
REM PRINT LONG EXPLANATION THE FIRST TIME ONLY
IF LEN(M$)>0 AND NOT EXPLAINPOINTS THEN
   GOSUB MESSAGE
   EXPLAINPOINTS = TRUE
END IF
REM TALLY CURRENT AND FULL SCORE
S = 0
T = 0
FOR J = 65 TO 90
   IF OBJT(J, SOLVED)=SOLVED THEN
       T = T + 5
       S = S + 5
   ELSE IF OBJT$(J, KIND) = "$" THEN
       IF OBJT(J, XSPOT) = ONYOU THEN
          T = T + 1
       ELSE IF OBJT(J, XSPOT) = ENTRX AND OBJT(J, YSPOT) = ENTRY THEN
          T = T + 4
       END IF
       IF OBJT(J, SOLVED) = 0 THEN S = S + 4
    END IF
    IF OBJT(J, SOLVED)=SOLUTION THEN
       S = S + 5
    END IF
NEXT J
M$ = "IF YOU WERE TO QUIT NOW, YOU WOULD SCORE A TOTAL OF "+T+" POINTS, OUT OF A POSSIBLE MAXIMUM OF "+S+" POINTS. IF YOU WANT TO END YOUR ADVENTURE EARLY, SAY 'QUIT'."
RETURN

QUIT:
RETURN

READOBJT:
REM ALL HANDLED BY COMMANDS
RETURN

SOUTH:
NEXTX=CRNTX
NEXTY=CRNTY+1
GOSUB TRYTOMOVE
RETURN

TAKE:
OVERRIDE=TRUE
IF OBJT(O, XSPOT) = ONYOU THEN
   M$ = "YOU ARE ALREADY CARRYING IT!"
ELSE
   REM TALLY NUMBER OF ITEMS CARRIED
   T=0
   FOR X= 65 TO 90
      IF OBJT(X, XSPOT) = ONYOU THEN T=T+1
   NEXT X
   REM CAN’T CARRY MORE THAN 7 ITEMS
   IF T<7 THEN
      OBJT(O, XSPOT) = ONYOU
      M$="OK."
      OVERRIDE=FALSE
   END IF
END IF
RETURN

USE:
REM ALL HANDLED BY COMMANDS
RETURN

VERBOSE:
VBSE = NOT VBSE
IF VBSE THEN
   M$ = "OKAY, FROM NOW ON I'LL ALWAYS DESCRIBE A PLACE IN FULL."
END IF
RETURN

WEST:
NEXTX=CRNTX-1
NEXTY=CRNTY
GOSUB TRYTOMOVE
RETURN

XPLORE:
IF OBJT(LAMP, XSPOT) <> ONYOU THEN
  M$="YOU CAN'T EXPLORE WITHOUT A LIGHT. SO LET'S JUST CALL IT A DAY."
  OVERRIDE=TRUE
ELSE
  GOSUB MESSAGE
  IF A$="X" THEN
    D=2
  ELSE
    D=4
  END IF
  T=0
  REPEAT 
    NEXTX = INT(RND*(XMAX-1)+1)
    NEXTY = INT(RND*(YMAX-1)+1)
    T = T+1
  UNTIL NEXTX<>CRNTX AND NEXTY<>CRNTY AND LEN(LOCN$(ABS(MAP(NEXTX, NEXTY)), PATH)) <= D AND (MAP(NEXTX, NEXTY)<0 OR T>7)
  LASTX = 0
  GOSUB MOVE
END IF
RETURN

YES:
IF LASTA$ = "Q" THEN
   GOSUB POINTS
   M$ = "YOU SCORE A TOTAL OF "+T+" POINTS, OUT OF A POSSIBLE MAXIMUM OF "+S+" POINTS."
   PCT = T/S
   FINALSCORE = T
   GOSUB MESSAGE
   REM DEBUG: PRINT PCT
   IF PCT<0.10 THEN
      M$ = "YOU ARE OBVIOUSLY A RANK AMATEUR.  BETTER LUCK NEXT TIME."
   ELSE IF PCT<0.29 THEN
      M$ = "YOUR SCORE QUALIFIES YOU AS A NOVICE CLASS ADVENTURER."
   ELSE IF PCT<0.37 THEN
      M$ = "YOU HAVE ACHIEVED THE RATING: 'EXPERIENCED ADVENTURER'."
   ELSE IF PCT<0.57 THEN
      M$ = "YOU MAY NOW CONSIDER YOURSELF A 'SEASONED ADVENTURER'."
   ELSE IF PCT<0.71 THEN
      M$ = "YOU HAVE REACHED 'JUNIOR MASTER' STATUS."
   ELSE IF PCT<0.85 THEN
      M$ = "YOUR SCORE PUTS YOU IN MASTER ADVENTURER CLASS C."
   ELSE IF PCT<0.95 THEN
      M$ = "YOUR SCORE PUTS YOU IN MASTER ADVENTURER CLASS B."
   ELSE IF PCT<1 THEN
      M$ = "YOUR SCORE PUTS YOU IN MASTER ADVENTURER CLASS A."
   ELSE
      M$ = "ALL OF ADVENTUREDOM GIVES TRIBUTE TO YOU, ADVENTURER GRANDMASTER!"
   END IF
   IF FINALSCORE>HIGHSCORE THEN
      HIGHSCORE = FINALSCORE
      M$=M$+" A NEW HIGH SCORE!"
   END IF
   GOSUB MESSAGE
   END
ELSE IF RIGHT$(LASTM$,1)="?" THEN
   M$ = "THAT WAS A RHETORICAL QUESTION."
END IF
RETURN

ZZZ:
REM ALL HANDLED BY COMMANDS
RETURN


REM *****
REM SUPPORT ROUTINES

DESCRIBE:
REM DESCRIBE THE LOCATION, FOR THE ‘LOOK’ ACTION OR ANY MOVES

REM DESCRIBE THE LOCATION
REM DEBUG: PRINT CRNTX
REM DEBUG: PRINT CRNTY
REM DEBUG: PRINT CRNTLOCN
REM DEBUG: PRINT LOCN$(CRNTLOCN, NAME)
M$ = LOCN$(CRNTLOCN, DESC)
REM IF THE LOCATION WAS VISITED AND VERBOSE DESCRIPTIONS TURNED OFF AND NOT CALLED BY ‘LOOK’
IF MAP(CRNTX, CRNTY)>0 AND NOT VBSE AND A$<>"L" THEN
   REM TRUNCATE AT THE ASTERISK (*) OR FIRST PERIOD
   X = INSTR(M$, "*")
   IF X=0 THEN X = INSTR(M$, ".")
   IF X=0 THEN X = LEN(M$) - 1
   M$ = LEFT$(M$,X-1) + "."
ELSE
   REM DESCRIBE IN FULL
   REM BUT FIRST REMOVE ASTERISK INDICATING TRUNCATION
   X = INSTR(M$, "*")
   IF X THEN M$ = LEFT$(M$,X-1) + MID$(M$, X+1, LEN(M$))
END IF
X = INSTR(M$, "@")
IF X THEN M$ = LEFT$(M$,X-1) + MID$(M$, X+1, LEN(M$))
GOSUB MESSAGE
REM THE LOCATION WAS VISITED
MAP(CRNTX, CRNTY) = ABS(MAP(CRNTX, CRNTY))
REM DESCRIBE THE OBJECTS FOUND HERE
FOR J = 65 TO 90
   IF OBJT(J, XSPOT) = CRNTX AND OBJT(J, YSPOT) = CRNTY THEN
      OBJT(J, FOUND)=TRUE
      M$ = OBJT$(J, DESC)
      GOSUB MESSAGE
   END IF
NEXT J
RETURN

MESSAGE:
REM PRINT MESSAGES ACROSS MULTIPLE LINES WITHOUT BREAKING UP WORDS 
LASTM$ = M$
REM DECRYPT
IF LEFT$(M$,1)="$" THEN
   FOR J=2 TO LEN(M$)
       MID$(M$,J,1) = CHR$(96-ASC(MID$(M$,J,1)))
   NEXT J
   M$ = MID$(M$,2,LEN(M$))
END IF
T=1
REPEAT
    IF LEN(M$)<=32 THEN
        PRINT M$
        M$=""
    ELSE
        M=32
        WHILE MID$(M$,M,1)<>" "
            M=M-1
        WEND
        PRINT LEFT$(M$,M-1)
        M$=MID$(M$,M+1,LEN(M$))
        T=T+1
     END IF
     IF T=17 THEN
        PRINT "(HIT ANY KEY TO CONTINUE)"
        WHILE INKEY$=""
        WEND
        T=1
     END IF
UNTIL LEN(M$)=0
RETURN

MOVE:
REM MOVE TO NEXTX, NEXTY
LASTX = CRNTX
LASTY = CRNTY
CRNTX = NEXTX
CRNTY = NEXTY
CRNTLOCN = ABS(MAP(CRNTX, CRNTY))
REM UPDATE PATH
P$=LOCN$(CRNTLOCN, PATH)
IF LEN(P$) < 4 THEN
   IF A$="N" AND INSTR(P$, "S")=0 THEN P$ = P$ + "S"
   IF A$="S" AND INSTR(P$, "N")=0 THEN P$ = P$ + "N"
   IF A$="W" AND INSTR(P$, "E")=0 THEN P$ = P$ + "E"
   IF A$="E" AND INSTR(P$, "W")=0 THEN P$ = P$ + "W"
   LOCN$(CRNTLOCN, PATH) = P$
END IF
GOSUB DESCRIBE
RETURN

TRYTOMOVE:
P$=LOCN$(CRNTLOCN, PATH)
IF LEN(P$)>4 THEN
   M$=P$
   OVERRIDE = TRUE
ELSE IF OBJT(LAMP, XSPOT) <> ONYOU THEN
   M$="IT IS PITCH BLACK. YOU ARE LIKELY TO BE EATEN BY A GRUE."
   OVERRIDE = TRUE
ELSE IF INSTR(P$,A$)>0 AND 1<=NEXTX AND NEXTX<=XMAX AND 1<=NEXTY AND NEXTY<=YMAX THEN
   GOSUB MOVE
END IF
RETURN

POSTPROCESS:
REM NOTE THAT ROOM MAY HAVE CHANGED
IF INSTR("BJNSEWX", A$)>0 THEN RETURN
REM LOOK UP CUSTOM COMMANDS
L$=LOCN$(ABS(MAP(CRNTX,CRNTY)), NAME)
O=ASC(O$)
REM IS THERE A COMMAND FOR THIS ACTION AND THIS OBJECT IN THIS LOCATION?
C= INSTR(CMNDLIST$,A$+O$+L$+" ")
REM IS THERE A COMMAND FOR THIS ACTION AND THIS KIND OF OBJECT IN THIS LOCATION?
IF C=0 THEN C= INSTR(CMNDLIST$,A$+OBJT$(O, KIND)+L$)
REM IS THERE A COMMAND FOR THIS ACTION AND ANY OBJECT IN THIS LOCATION?
IF C=0 THEN C= INSTR(CMNDLIST$,A$+"*"+L$)
REM IS THERE A COMMAND FOR THIS ACTION AND THIS KIND OF OBJECT IN ANY LOCATION?
IF C=0 THEN C= INSTR(CMNDLIST$,A$+O$+"***")
IF C=0 THEN RETURN 
C = INT( (C-1)/6+1 )
REM EXECUTE COMMAND
M$=CMND$(C, MSSG)
OBJTCMND$ = CMND$(C, XFRMOBJT)
IF OBJTCMND$="DRO" THEN
   OBJT(O, XSPOT) = CRNTX
   OBJT(O, YSPOT) = CRNTY
ELSE IF OBJTCMND$="RMV" THEN
   OBJT(O, XSPOT) = REMOVED
ELSE IF OBJTCMND$="TAK" THEN
   OBJT(O, XSPOT) = ONYOU
ELSE IF LEFT$(OBJTCMND$,4)="RND:" THEN
   REPEAT
      OBJT(O, XSPOT) = INT(RND*XMAX+1)
      OBJT(O, YSPOT) = INT(RND*YMAX+1)
   UNTIL OBJT(O, XSPOT) <> CRNTX
   IF LEN(OBJTCMND$)>5 THEN OBJT$(O, DESC) = MID$(OBJTCMND$, 6, LEN(OBJTCMND$))
ELSE IF MID$(OBJTCMND$, 4, 1)=":" THEN
   REM FIND LOCATION NAME
   S$ = LEFT$(OBJTCMND$,3)
   FOR L = 1 TO LOCNMAX
      IF LOCN$(L, NAME) = S$ THEN
         FOR X = 1 TO XMAX
              FOR Y = 1 TO YMAX
                  IF ABS(MAP(X, Y)) = L THEN
                     OBJT(O, XSPOT) = X
                     OBJT(O, YSPOT) = Y
                     X = XMAX+1
                     Y = YMAX+1
                  END IF
              NEXT Y
          NEXT X
          L = LOCNMAX + 1
      END IF
   NEXT L
   IF LEN(OBJTCMND$)>4 THEN OBJT$(O, DESC) = MID$(OBJTCMND$, 6, LEN(OBJTCMND$))
ELSE IF OBJTCMND$<>"" THEN
   OBJT$(O, DESC) = OBJTCMND$
END IF
REM REVISE LOCATION
LOCNCMND$ = CMND$(C, XFRMLOCN)
REM DEBUG: PRINT A$+O$+L$+" / "+OBJTCMND$+" / "+LOCNCMND$
IF LEFT$(LOCNCMND$, 3)="WIN" THEN
   GOSUB MESSAGE
   LASTA$="Q"
   GOSUB YES
   END
ELSE IF LEN(LOCNCMND$)>0 THEN
   OBJT(O, SOLVED)=SOLVED
   L = MAP(CRNTX, CRNTY)
   LOCN$(L, NAME) = LEFT$(LOCNCMND$, 3)
   LOCNCMND$ = MID$(LOCNCMND$, 6, LEN(LOCNCMND$))
   LOCN$(L, DESC) = LOCNCMND$
   REM UPDATE PATH
   IF INSTR(LOCNCMND$, "ALL DIRECTIONS") THEN
      P$ = "NSEW"
   ELSE
      P$ = ""
     IF INSTR(LOCNCMND$, "NORTH") THEN P$ = P$ + "N"
     IF INSTR(LOCNCMND$, "SOUTH") THEN P$ = P$ + "S"
     IF INSTR(LOCNCMND$, "EAST") THEN P$ = P$ + "E"
     IF INSTR(LOCNCMND$, "WEST") THEN P$ = P$ + "W"
     IF LEN(P$)=0 THEN P$ = "NSEW"
   END IF
   LOCN$(L, PATH) = P$
END IF
RETURN

INIT:
REM ***DATA***
REM WRITE YOUR OWN ADVENTURE HERE!

TITLE$ = "ADVENTURE"

LOCATIONS:
REM NAME, PATH, DESC
REM - 3-LETTER NAME OF ROOM (MUST BE UNIQUE)
REM - PATH CONTAINS "NSEW" FOR VALID DIRECTIONS OR AN OBSTACLE MESSAGE IF IMPASSIBLE
REM - DESC CONTAINS A DESCRIPTION. 
REM --THE SHORTER VERSION, FOR SUBSEQUENT VISITS, ENDS AT AN ASTERISK OR PERIOD
REM --A CREATURE SHOULD BE MARKED WITH AN @, E.G. "A CAVE @BEAR" FOR THE GIVE ACTION (NAME MUST BE FOLLOWED BY A SPACE)
REM SET THE NUMBER OF LOCATIONS AND DIMENSIONS OF THE MAP
LOCNMAX=87
REM PAD LOCATION WITH BORDER
XMAX = 9+2
YMAX = 10+2
REM NOTE: WIDER THAN 7 NOT COUNTING BORDER WILL BREAK MAP
DATA "---", "NSWE", "YOU ARE IN A PART OF A LARGE, FLAT EMPTY CAVERN."
DATA "-N-", "EWS", "YOU ARE IN THE LONG EAST/WEST PASSAGEWAY."
DATA "-S-", "NWE", "YOU ARE IN THE EAST/WEST CORRIDOR."
DATA "-W-", "NSE", "YOU ARE IN THE LONG NORTH/SOUTH PASSAGEWAY."
DATA "-E-", "NSW", "YOU ARE IN THE NORTH/SOUTH CORRIDOR."
DATA "ENT", "NSWE", "YOU ARE IN THE ENTRANCE CHAMBER* BENEATH A 3X3 STEEL GRATE UP TO THE SURFACE. THE GRATE IS MOUNTED IN CONCRETE. PASSAGES LEAD OFF IN ALL DIRECTIONS."
DATA "25A", "NS", "YOU ARE IN A NORTH/SOUTH CANYON* ABOUT 25 FEET ACROSS. THE FLOOR IS COVERED BY WHITE MIST SEEPING IN FROM THE NORTH. THE WALLS EXTEND UPWARD FOR WELL OVER 100 FEET. A SMALL WINDOW CAN BE SEEN IN EITHER WALL, SOME FIFTY FEET UP."
DATA "2PT", "NW", "YOU ARE IN A ROOM WITH TWO PITS. THERE IS A LARGE HOLE IN THE WALL ABOVE THE WESTERN PIT."
DATA "30F", "SWE", "YOU ARE ON THE BRINK OF A THIRTY FOOT PIT* WITH A MASSIVE ORANGE COLUMN DOWN ONE WALL."
DATA "3CY", "NSE", "YOU ARE IN A SECRET CANYON AT A JUNCTION OF THREE CANYONS*, BEARING NORTH, SOUTH, AND SE. THE NORTH ONE IS AS TALL AS THE OTHER TWO COMBINED."
DATA "ALC", "NE", "YOU ARE IN AN ALCOVE. A SMALL NORTH PATH SEEMS TO WIDEN AFTER A SHORT DISTANCE. AN EXTREMELY TIGHT TUNNEL LEADS EAST. IT LOOKS LIKE A VERY TIGHT SQUEEZE."
DATA "ARC", "NSW", "YOU ARE IN AN ARCHED HALL. A CORAL PASSAGE ONCE CONTINUED UP AND EAST FROM HERE, BUT IS NOW BLOCKED BY DEBRIS. THE AIR SMELLS OF SEA WATER."
DATA "AWK", "WE", "YOU ARE IN AN AWKWARD SLOPING EAST/WEST CANYON."
DATA "BDQ", "NSWE", "YOU ARE IN BEDQUILT*, A LONG EAST/WEST PASSAGE WITH HOLES EVERYWHERE."
DATA "BEA", "THERE IS NO WAY TO GET PAST THE BEAR, WHICH IS PROBABLY JUST AS WELL.", "YOU ARE STANDING AT AN ENTRANCE TO A LARGE, BARREN ROOM. A SIGN POSTED ABOVE THE ENTRANCE READS: 'CAUTION! BEAR IN ROOM!' THE WAY IS GUARDED BY A FEROCIOUS CAVE @BEAR EYING YOU FROM THE FAR END OF THE ROOM!"
DATA "BLD", "W", "YOU ARE IN A MASS OF BOULDERS* -- DEAD END."
DATA "BRK", "SW", "YOU ARE ON THE BRINK OF A SMALL CLEAN CLIMBABLE PIT. A CRAWL LEADS WEST."
DATA "CHA", "THERE IS NO WAY ACROSS.", "A WIDE CHASM YAWNS BEFORE YOU. THERE IS NO WAY ACROSS."
DATA "CHM", "SW", "YOU ARE ON ONE SIDE OF A LARGE, DEEP CHASM. A HEAVY WHITE MIST RISING UP FROM BELOW OBSCURES ALL VIEW OF THE FAR SIDE. A SW PATH LEADS AWAY FROM THE CHASM INTO A WINDING CORRIDOR."
DATA "CHS", "NSWE", "YOU ARE IN A ROOM WHOSE WALLS RESEMBLE SWISS CHEESE. OBVIOUS PASSAGES GO WEST, EAST, NORTH, AND SOUTH. PART OF THE ROOM IS OCCUPIED BY A LARGE BEDROCK BLOCK."
DATA "CIN", "E", "THE PASSAGE HERE IS BLOCKED BY A RECENT CAVE-IN."
DATA "CLM", "YOU CAN'T FIT BY THIS FIVE-FOOT CLAM THROUGH THAT LITTLE PASSAGE!", "YOU'RE IN A TINY CHAMBER* CARVED OUT OF SEDIMENTARY ROCK. THE FLOOR AND WALLS ARE LITTERED WITH BITS OF SHELLS IMBEDDED IN THE STONE. A SHALLOW PASSAGE PROCEEDS WEST, AND A SOMEWHAT STEEPER ONE LEADS EAST. A LOW HANDS AND KNEES PASSAGE ENTERS FROM THE SOUTH. THERE IS AN ENORMOUS @CLAM HERE WITH ITS SHELL TIGHTLY CLOSED."
DATA "COR", "WE", "YOU ARE IN A LONG, NARROW CORRIDOR* STRETCHING OUT OF SIGHT TO THE WEST. AT THE EASTERN END IS A HOLE THROUGH WHICH YOU CAN SEE A PROFUSION OF LEAVES."
DATA "CPX", "NWE", "YOU ARE AT A COMPLEX JUNCTION. A LOW HANDS AND KNEES PASSAGE FROM THE NORTH JOINS A HIGHER CRAWL FROM THE EAST TO MAKE A WALKING PASSAGE GOING WEST. THERE IS ALSO A LARGE ROOM ABOVE. THE AIR IS DAMP HERE."
DATA "CRC", "NW", "YOU ARE IN A LARGE LOW CIRCULAR CHAMBER* WHOSE FLOOR IS AN IMMENSE SLAB FALLEN FROM THE CEILING. EAST AND WEST THERE ONCE WERE LARGE PASSAGES, BUT THEY ARE NOW FILLED WITH BOULDERS. LOW SMALL PASSAGES GO NORTH AND SOUTH, AND THE SOUTH ONE QUICKLY BENDS WEST AROUND THE BOULDERS."
DATA "CUL", "W", "YOU ARE IN A CUL-DE-SAC* ABOUT EIGHT FEET ACROSS."
DATA "CVN", "SW", "YOU ARE IN A MAGNIFICENT CAVERN* WITH A RUSHING STREAM, WHICH CASCADES OVER A SPARKLING WATERFALL INTO A ROARING WHIRLPOOL WHICH DISAPPEARS THROUGH A HOLE IN THE FLOOR. PASSAGES EXIT TO THE SOUTH AND WEST."
DATA "DBR", "W", "YOU ARE IN A DEBRIS ROOM* FILLED WITH STUFF WASHED IN FROM THE SURFACE. A LOW WIDE PASSAGE WITH COBBLES BECOMES PLUGGED WITH MUD AND DEBRIS HERE, BUT A CANYON LEADS UPWARD AND WEST."
DATA "DEC", "W", "YOU ARE IN A SMALL CHAMBER* FILLED WITH LARGE BOULDERS. THE ONLY EXIT IS A CRAWL HEADING WEST."
DATA "DED", "E", "DEAD END CRAWL."
DATA "DOR", "THE DOOR IS EXTREMELY RUSTY AND REFUSES TO OPEN.", "YOU ARE AT ONE END OF AN IMMENSE NORTH/SOUTH PASSAGE. THE WAY IS BARRED BY A MASSIVE, RUSTY, IRON DOOR."
DATA "DRG", "THE DRAGON LOOKS RATHER NASTY. YOU'D BEST NOT TRY TO GET BY.", "YOU ARE IN A SECRET CANYON WHICH EXITS TO THE NORTH AND EAST: A HUGE GREEN FIERCE @DRAGON BARS THE WAY."
DATA "DRK", "S", "YOU'RE IN THE DARK-ROOM. A CORRIDOR LEADING SOUTH IS THE ONLY EXIT."
DATA "DRT", "WE", "YOU ARE IN A DIRTY BROKEN PASSAGE. TO THE EAST IT NARROWS TO A CRAWL. TO THE WEST IT WIDENS."
DATA "DST", "NSEW", "YOU ARE IN A LARGE ROOM* FULL OF DUSTY ROCKS. THERE IS A BIG HOLE IN THE FLOOR. THERE ARE CRACKS EVERYWHERE, AND A PASSAGE LEADING EAST."
DATA "DWA", "THE DWARF THROWS HIS AXE AT YOU. IT BARELY MISSES, THEN BOOMERANGS BACK INTO HIS WAITING HAND.", "YOU ARE IN A LONG WINDING CORRIDOR SLOPING OUT OF SIGHT IN BOTH DIRECTIONS: A LITTLE @DWARF WITH A LITTLE AXE BLOCKS YOUR WAY."
DATA "DWF", "THE DWARF PUNCHES YOU, AND YOU RETREAT.", "YOU ARE IN A LONG SLOPING CORRIDOR WITH RAGGED SHARP WALLS: A LITTLE @DWARF FACES YOU, WITH BOTH FISTS UP, WAITING."
DATA "DWR", "THE DWARF BLOCKS YOUR WAY.", "YOU'RE IN A LONG EAST/WEST CORRIDOR: A LITTLE @DWARF WITH A TRIM BEARD AND A BIG KNIFE BLOCKS YOUR WAY."
DATA "E/W", "WE", "YOU ARE IN A SECRET CANYON RUNNING EAST/WEST. IT CROSSES OVER A VERY TIGHT CANYON FIFTY FEET BELOW."
DATA "FRK", "NSW", "THE PATH FORKS HERE. THE LEFT FORK LEADS NORTH. THE RIGHT FORK LEADS SOUTH DOWN A GENTLE SLOPE. THE MAIN CORRIDOR ENTERS FROM THE WEST."
DATA "FRZ", "WE", "YOU ARE IN A SPLENDID CHAMBER* THIRTY FEET HIGH. THE WALLS ARE FROZEN RIVERS OF ORANGE STONE. A CANYON AND A GOOD PASSAGE EXIT FROM EAST AND WEST SIDES OF THE CHAMBER."
DATA "FSR", "THERE IS NO WAY ACROSS THE FISSURE.", "THE WAY IS BLOCKED BY A FISSURE* SLICING CLEAR ACROSS THE ROOM. MIST IS QUITE THICK HERE, AND THE FISSURE IS TOO WIDE TO JUMP. "
DATA "GIA", "YOU’D BEST NOT TRY TO GET BY.", "YOU ARE IN THE GIANT ROOM. THE CEILING HERE IS TOO HIGH UP FOR YOUR LAMP TO SHOW IT. CAVERNOUS PASSAGES LEAD EAST, NORTH, AND SOUTH. A @GIANT SAYS, 'AH, WHAT’S THIS I SMELL? FEE-FIE-FOE-FUM.'"
DATA "GRT", "THE GRATE IS VERY SOLID AND HAS A HARDENED STEEL LOCK. YOU CANNOT ENTER WITHOUT A KEY. ARE THERE KEYS NEARBY?", "A STRONG BUT OLD IRON GRATE BARS THE WAY."
DATA "GTO", "W", "A ROTTED PIRATE SHIP RESTS HERE*, ALONGSIDE A DRIED UP RIVERBED. THE SHIP'S NAME, 'THE INFERNO', CAN STILL BE MADE OUT AMONG THE ROTTED TIMBERS. A @SKELETON WITH AN EYE PATCH RESTS BEFORE IT."
DATA "HAL", "NSE", "YOU ARE IN A LONG FEATURELESS HALL. THE HALL JOINS UP WITH A NARROW NORTH/SOUTH PASSAGE."
DATA "HOL", "NS", "YOU ARE IN A LOW NORTH/SOUTH PASSAGE* WITH A HOLE IN THE FLOOR."
DATA "INC", "NSW", "YOU ARE AT THE TOP OF A STEEP INCLINE. THERE IS A PASSAGE LEADING TO THE NORTH."
DATA "JUM", "NSEW", "YOU ARE IN A JUMBLE OF ROCK*, WITH CRACKS EVERYWHERE."
DATA "LLR", "NWE", "YOU ARE IN A LARGE LOW ROOM. CRAWLS LEAD NORTH, EAST, AND WEST."
DATA "LNG", "NE", "YOU ARE IN A VERY LONG HALL* APPARENTLY WITHOUT SIDE CHAMBERS. TO THE EAST A LOW WIDE CRAWL SLANTS UP. TO THE NORTH A ROUND TWO FOOT HOLE SLANTS DOWN."
DATA "LOW", "WE", "YOU ARE CRAWLING OVER COBBLES* IN A LOW PASSAGE."
DATA "LSN", "NS", "YOU ARE WALKING A LIMESTONE PASSAGE*, ALONG A GENTLY SLOPING NORTH/SOUTH ROUTE LINED WITH ODDLY SHAPED LIMESTONE FORMATIONS."
DATA "LWC", "SE", "ANOTHER PASSAGE LEADS SOUTH*, AND A LOW CRAWL GOES EAST."
DATA "MAZ", "YOU ARE IN A MAZE OF TWISTY LITTLE PASSAGES, ALL ALIKE.", "YOU ARE IN A MAZE OF TWISTY LITTLE PASSAGES, ALL ALIKE."
DATA "MIR", "SE", "YOU ARE IN A DEEP CANYON. SUSPENDED FROM SOME UNSEEN POINT FAR ABOVE YOU, AN ENORMOUS TWO-SIDED MIRROR IS HANGING PARALLEL TO AND MIDWAY BETWEEN THE CANYON WALLS. (THE MIRROR IS OBVIOUSLY PROVIDED FOR THE USE OF THE DWARVES, WHO AS YOU KNOW, ARE EXTREMELY VAIN.)"
DATA "MST", "NSW", "YOU ARE IN A HALL OF MISTS. A LOW WIDE CRAWL CONTINUES WEST AND ANOTHER GOES NORTH. TO THE SOUTH IS A LITTLE PASSAGE 6 FEET OFF THE FLOOR."
DATA "N/S", "NS", "YOU ARE IN A SECRET NORTH/SOUTH CANYON."
DATA "NWP", "NW", "YOU ARE IN A NORTH/WEST PASSAGEWAY."
DATA "ORI", "NWSE", "THIS IS THE ORIENTAL ROOM. ANCIENT ORIENTAL CAVE DRAWINGS COVER THE WALLS. A GENTLY SLOPING PASSAGE LEADS UPWARD TO THE NORTH, ANOTHER PASSAGE LEADS SE, AND A HANDS & KNEES CRAWL LEADS WEST."
DATA "PIR", "THE PIRATE IS WAITING.", "A NARROW CRAWL LEADS DOWN INTO A MAZE OF TWISTY LITTLE PASSAGES. CLAMBERING UP FROM THE SHADOWS POUNCES A BEARDED @PIRATE WHO CHORTLES 'HAR, HAR! I'LL JUST TAKE ALL YOUR BOOTY AND HIDE IT AWAY IN ME MAZE!'"
DATA "PLC", "NS", "YOU ARE AT A WIDE PLACE* IN AN OTHERWISE VERY TIGHT N/S CANYON."
DATA "PLT", "YOU CAN'T CROSS THE PIT.", "THE FLOOR HERE IS LITTERED WITH THIN ROCK SLABS* AROUND A LARGE PIT. THERE ARE HOLES ALL OVER, BUT TOO HIGH UP ABOVE THE PIT, WHERE YOU CAN'T GET TO THEM. THERE IS A TINY LITTLE PLANT IN THE PIT, MURMURING 'WATER, WATER, ...'"
DATA "PSG", "WE", "YOU ARE IN A SIDE CHAMBER. A PASSAGE CONTINUES WEST AND UP HERE."
DATA "PTH", "SW", "YOU ARE FOLLOWING A WIDE PATH* AROUND THE OUTER EDGE OF A LARGE CAVERN. FAR BELOW, THROUGH A HEAVY WHITE MIST, STRANGE SPLASHING NOISES CAN BE HEARD. THE MIST RISES UP THROUGH A FISSURE IN THE CEILING. THE PATH EXITS TO THE SOUTH AND WEST."
DATA "PTS", "WE", "YOU ARE IN A ROOM OF PITS. THE FLOOR HERE IS LITTERED WITH THIN ROCK SLABS, WHICH MAKE IT EASY TO DESCEND THE PITS. A PATH HERE BYPASSES THE PITS TO CONNECT PASSAGES FROM EAST AND WEST. THERE ARE HOLES ALL OVER, BUT THE ONLY BIG ONE IS ON THE WALL DIRECTLY OVER THE WEST PIT WHERE YOU CAN'T GET TO IT."
DATA "REP", "SHHH! YOU'LL WAKE THE DWARVES. DWARFS?", "YOU ARE IN THE REPOSITORY. YOU SEE A PILE OF BOTTLES, A NURSERY OF YOUNG BEANSTALKS MURMURING QUIETLY, A BED OF OYSTERS, A BUNDLE OF BLACK RODS WITH RUSTY MARKS ON THEIR ENDS, AND A COLLECTION OF BRASS LANTERNS. VARIOUS SUNDRY OBJECTS CAN BE GLIMPSED DIMLY IN THE DISTANCE. OFF TO ONE SIDE FOUR DWARVES ARE SLEEPING ON THE FLOOR, SNORING LOUDLY AMIDST A GREEN SMOKY VAPOR. A SIGN NEARBY READS: 'DO NOT DISTURB THE @DWARVES !'"
DATA "RES", "S", "YOU ARE AT THE EDGE OF AN UNDERGROUND RESERVOIR. AN OPAQUE CLOUD OF WHITE MIST FILLS THE ROOM AND RISES RAPIDLY UPWARD. THE LAKE IS FED BY A STREAM, WHICH TUMBLES OUT OF A HOLE IN THE WALL ABOUT 10 FEET OVERHEAD AND SPLASHES NOISILY INTO THE WATER SOMEWHERE WITHIN THE MIST. THE ONLY PASSAGE GOES TOWARD THE SOUTH."
DATA "SDE", "N", "YOU ARE IN A SIDE CHAMBER."
DATA "SFT", "NSEW", "YOU ARE IN THE SOFT ROOM. THE WALLS ARE COVERED WITH HEAVY CURTAINS, THE FLOOR WITH A THICK PILE CARPET. MOSS COVERS THE CEILING."
DATA "SNK", "YOU CAN'T KILL THE SNAKE, OR DRIVE IT AWAY, OR AVOID IT, OR ANYTHING LIKE THAT. THERE IS A WAY TO GET BY.", "YOU ARE IN THE HALL OF THE MOUNTAIN KING, WITH PASSAGES OFF IN ALL DIRECTIONS: A HUGE GREEN FIERCE @SNAKE BARS THE WAY."
DATA "SPT", "W", "AT YOUR FEET IS A SMALL PIT BREATHING* TRACES OF WHITE MIST. AN EAST PASSAGE ENDS HERE EXCEPT FOR A SMALL CRACK LEADING ON."
DATA "STA", "NSE", "A LARGE STALACTITE EXTENDS FROM THE ROOF* AND ALMOST REACHES THE FLOOR BELOW. YOU COULD CLIMB DOWN IT, AND JUMP FROM IT TO THE FLOOR, BUT HAVING DONE SO YOU WOULD BE UNABLE TO REACH IT TO CLIMB BACK UP."
DATA "STR", "N", "YOU ARE IN THE BOTTOM OF A SMALL PIT* WITH A LITTLE STREAM, WHICH ENTERS AND EXITS THROUGH TINY SLITS."
DATA "TAL", "NWE", "YOU ARE IN A TALL EAST/WEST CANYON. A LOW TIGHT CRAWL GOES THREE FEET NORTH AND SEEMS TO OPEN UP."
DATA "TRL", "THE TROLL STEPS OUT FROM BENEATH THE BRIDGE AND BLOCKS YOUR WAY.", "A RICKETY WOODEN BRIDGE EXTENDS ACROSS* A CHASM, VANISHING INTO THE MIST. A SIGN POSTED ON THE BRIDGE READS, 'STOP! PAY TROLL!' A BURLY @TROLL STANDS BY THE BRIDGE AND INSISTS YOU THROW HIM A TREASURE BEFORE YOU MAY CROSS."
DATA "VLC", "S", "FAR BELOW YOU IS AN ACTIVE VOLCANO*, FROM WHICH GREAT GOUTS OF MOLTEN LAVA COME SURGING OUT, CASCADING BACK DOWN INTO THE DEPTHS. GLOWING ROCK FILLS THE FARTHEST REACHES OF THE CAVERN WITH A BLOOD-RED GLARE, AN EERIE, MACABRE APPEARANCE. THE AIR IS FILLED WITH FLICKERING SPARKS OF ASH AND A HEAVY SMELL OF BRIMSTONE. THE WALLS ARE HOT TO THE TOUCH, AND THE THUNDERING OF THE VOLCANO DROWNS OUT ALL OTHER SOUNDS. A DARK, FOREBODING PASSAGE EXITS TO THE SOUTH."
DATA "VST", "SWE", "YOU ARE IN A VAST HALL WITH OPENINGS TO EITHER SIDE. A WIDE STONE STAIRCASE LEADS DOWNWARD INTO DEBRIS. THE HALL IS FILLED WITH WISPS OF WHITE MIST SWAYING TO AND FRO AS IF ALIVE. A COLD WIND BLOWS UP THE STAIRCASE."
DATA "WDE", "NSEW", "YOU HAVE CRAWLED THROUGH A LOW WIDE PASSAGE."
DATA "WDP", "SW", "YOU ARE IN A WINDING PASSAGEWAY* THAT GOES SOUTH AND WEST FROM HERE."
DATA "WFL", "THE FORCE OF THE WATER WILL PUSH AND TRAP YOU IN THE CRACK.", "A TORRENTIAL WATERFALL BLOCKS A NARROW ARCHWAY*, POURING INTO AND ECHOING DOWN A DEEP CRACK."
DATA "WIT", "SWE", "YOU ARE IN AN ANTEROOM* LEADING TO A LARGE PASSAGE TO THE EAST. SMALL PASSAGES GO WEST AND SOUTH. THE REMNANTS OF RECENT DIGGING ARE EVIDENT A SIGN IN MIDAIR HERE SAYS 'CAVE UNDER CONSTRUCTION BEYOND THIS POINT. PROCEED AT OWN RISK. [WITT CONSTRUCTION COMPANY]'"
DATA "WIZ", "HE SAYS, 'YOU SHALL NOT PASS.'", "YOU'RE IN A SMALL CHAMBER LIT BY AN EERIE GREEN LIGHT. A LARGE CLOUD OF GREEN SMOKE BILLOWS IN FRONT OF YOU. IT CLEARS AWAY TO REVEAL A TALL @WIZARD, CLOTHED IN GREY. HE FIXES YOU WITH A STEELY GLARE AND DECLARES, 'LOCOMOTOR MORTIS.' WITH THAT HE MAKES A SINGLE PASS OVER YOU WITH HIS HANDS, AND TRAINS HIS EYES ON YOU. YOU CANNOT MOVE."
DATA "WND", "NSWE", "YOU ARE AT WITT'S END. PASSAGES LEAD OFF IN ALL DIRECTIONS."
DATA "WNW", "NSW", "YOU'RE AT A LOW WINDOW OVERLOOKING A HUGE PIT*, WHICH EXTENDS UP OUT OF SIGHT. A FLOOR IS INDISTINCTLY VISIBLE OVER 50 FEET BELOW. TRACES OF WHITE MIST COVER THE FLOOR OF THE PIT, BECOMING THICKER TO THE RIGHT."
DATA "XVR", "NSWE", "YOU ARE AT A CROSSOVER OF A HIGH N/S PASSAGE AND A LOW E/W ONE."
DATA "Y2", "WS", "YOU ARE IN A LARGE ROOM*, WITH A PASSAGE TO THE SOUTH, A PASSAGE TO THE WEST, AND A WALL OF BROKEN ROCK TO THE EAST. THERE IS A LARGE 'Y2' ON A ROCK IN THE ROOM'S CENTER."

ACTIONDATA:
REM ABC ADVENTURE SUPPORTS UP TO 26 ACTIONS, EACH STARTING WITH A UNIQUE LETTER
REM YOU CAN REPLACE WITH SYNONYMS - OR CHANGE ALTOGETHER IF YOU REWRITE THAT ACTION HANDLER
REM NAME, TRANSITIVE/INTRANSITIVE, MESSAGE
REM - NAME (STARTS WITH A UNIQUE LETTER)
REM - "T" FOR TRANSITIVE (REQUIRES OBJECT), "I" FOR INTRANSITIVE (DOESN’T)
REM - DEFAULT MESSAGE (E.G., "READ" = "NOTHING IS WRITTEN ON IT.")
DATA "ACTIONS", "I", "HERE IS MY VOCABULARY OF ACTIONS:"
DATA "BACK", "I", "SORRY, BUT I NO LONGER SEEM TO REMEMBER HOW IT WAS YOU GOT HERE."
DATA "CLOSE", "T", "I DON'T KNOW HOW TO OPEN OR CLOSE SUCH A THING."
DATA "DROP", "T", "YOU AREN'T CARRYING ANYTHING."
DATA "EAST", "I", "THERE IS NO WAY TO GO THAT DIRECTION."
DATA "FIGHT", "I", "THERE IS NOTHING HERE TO FIGHT."
DATA "GIVE", "T", "THERE IS NO ONE HERE TO GIVE IT TO."
DATA "HELP", "I", "I KNOW OF PLACES, ACTIONS, AND THINGS. MOST OF MY VOCABULARY DESCRIBES 'ACTIONS' (TRY THAT WORD). TO MOVE, TRY WORDS LIKE 'EAST', 'WEST', 'NORTH', 'SOUTH', 'XPLORE'. NOTE THAT CAVE PASSAGES TURN A LOT, AND THAT LEAVING A ROOM TO THE NORTH DOES NOT GUARANTEE YOU CAN RETURN TO IT BY GOING SOUTH. GOING 'BACK' SOMETIMES WORKS. I KNOW ABOUT A FEW SPECIAL OBJECTS, LIKE A BLACK 'ROD' HIDDEN IN THE CAVE. THESE OBJECTS CAN BE MANIPULATED USING SOME OF THE ACTION WORDS THAT I KNOW. USUALLY YOU WILL NEED TO GIVE BOTH THE ACTION AND OBJECT WORDS (IN THAT ORDER), BUT SOMETIMES I CAN INFER THE OBJECT FROM THE VERB ALONE. SOME OBJECTS ALSO IMPLY VERBS; IN PARTICULAR, 'INVENTORY' IMPLIES 'TAKE INVENTORY', WHICH CAUSES ME TO GIVE YOU A LIST OF WHAT YOU'RE CARRYING. USUALLY PEOPLE TRYING UNSUCCESSFULLY TO MANIPULATE AN OBJECT ARE ATTEMPTING SOMETHING BEYOND THEIR (OR MY!) CAPABILITIES AND SHOULD TRY A COMPLETELY DIFFERENT TACK. TO SEE HOW WELL YOU ARE DOING, SAY 'POINTS'. GOOD LUCK!"
DATA "INVENTORY", "I", "YOU ARE CURRENTLY HOLDING THE FOLLOWING:"
DATA "JUMP", "I", "YOU LANDED IN A PIT THEN CRAWLED A LONG WAY."
DATA "KICK", "I", "THERE IS NOTHING HERE TO KICK."
DATA "LOOK", "I", "SORRY, BUT I AM NOT ALLOWED TO GIVE MORE DETAIL. I WILL REPEAT THE LONG DESCRIPTION OF YOUR LOCATION."
DATA "MAP", "I", "RUNES MAGICALLY APPEAR ON THE MAP AS YOU TRAVEL."
DATA "NORTH", "I", "THERE IS NO WAY TO GO THAT DIRECTION."
DATA "OPEN", "T", "IT CAN'T BE OPENED."
DATA "POINTS", "I", "TO GET FULL CREDIT FOR A TREASURE, YOU MUST HAVE LEFT IT SAFELY IN THE ENTRANCE, THOUGH YOU GET PARTIAL CREDIT JUST FOR LOCATING IT. YOU LOSE POINTS FOR GETTING KILLED, OR FOR QUITTING, THOUGH THE FORMER COSTS YOU MORE. THERE ARE ALSO POINTS BASED ON HOW MUCH (IF ANY) OF THE CAVE YOU'VE MANAGED TO EXPLORE; IN PARTICULAR, THERE ARE BONUSES FOR WHETHER YOU'VE BEEN THROUGH SOME OF THE MORE HARROWING SECTIONS. IF YOU THINK YOU'VE FOUND ALL THE TREASURES, JUST KEEP EXPLORING FOR A WHILE. IF NOTHING INTERESTING HAPPENS, YOU HAVEN'T FOUND THEM ALL YET. IF SOMETHING INTERESTING *DOES* HAPPEN, IT MEANS YOU'RE GETTING A BONUS AND HAVE AN OPPORTUNITY TO GARNER MANY MORE POINTS IN THE MASTER'S SECTION. I MAY OCCASIONALLY OFFER HINTS IF YOU SEEM TO BE HAVING TROUBLE. IF I DO, I'LL WARN YOU IN ADVANCE HOW MUCH IT WILL AFFECT YOUR SCORE TO ACCEPT THE HINTS. FINALLY, TO SAVE PAPER, YOU MAY SPECIFY ‘VERBOSE’, WHICH TOGGLES BETWEEN ME BEING BRIEF AND VERBOSE AND WHICH TELLS ME NEVER TO REPEAT THE FULL DESCRIPTION OF A PLACE UNLESS YOU EXPLICITLY ASK ME TO."
DATA "QUIT", "I", "DO YOU REALLY WANT TO QUIT NOW?"
DATA "READ", "T", "NOTHING IS WRITTEN ON IT."
DATA "SOUTH", "I", "THERE IS NO WAY TO GO THAT DIRECTION."
DATA "TAKE", "T", "YOU CAN'T CARRY ANYTHING MORE. YOU'LL HAVE TO DROP SOMETHING FIRST."
DATA "USE", "T", "THIS OBJECT IS NOT IMMEDIATELY USEFUL."
DATA "VERBOSE", "I", "OKAY, FROM NOW ON I'LL ONLY DESCRIBE A PLACE IN FULL THE FIRST TIME. YOU COME TO IT. TO GET THE FULL DESCRIPTION, SAY 'LOOK'."
DATA "WEST", "I", "THERE IS NO WAY TO GO THAT DIRECTION."
DATA "XPLORE", "I", "YOU HAVE CRAWLED AROUND IN SOME LITTLE HOLES AND WOUND UP HERE:"
DATA "YES", "I", "I COULDN'T AGREE MORE."
DATA "ZZZ...", "I", "THAT WAS REFRESHING . EVEN THE KISSES OF THE DWARVES COULD NOT WAKE YOU."
REM END OF ACTIONS
DATA "["

OBJECTS:
REM ABC ADVENTURE SUPPORTS UP TO 26 OBJECTS, EACH STARTING WITH A UNIQUE LETTER
REM NAME, KIND, DESCRIPTION
REM - NAME - ONE OR TWO WORDS DESCRIBING ITEM
REM - KIND:
REM -- "$" - TREASURE, WORTH 5 POINTS IF RETURNED TO ENTRANCE
REM -- "+" - OPENED CONTAINER, CAN BE CLOSED
REM -- "-" - CLOSED CONTAINER, CAN BE OPENED
REM -- "!" - LAMP, NEEDED TO EXPLORE
REM -- "%" - ANY OTHER OBJECT
REM -- CAN USE ANY CHARACTER TO DEFINE DIFFERENT "CLASSES" OF OBJECTS FOR PATTERN MATCHING IN THE COMMANDS SECTION (E.G., COULD HAVE "/" FOR WEAPONS)
DATA "AXE", "%", "A LITTLE DWARF AXE IS HERE."
DATA "BIRDCAGE", "-", "A CHEERFUL LITTLE BIRD IS SITTING IN A CAGE SINGING."
DATA "CHEST", "-", "A LARGE TREASURE CHEST IS HERE."
DATA "DIAMONDS", "$", "THERE ARE DIAMONDS HERE!"
DATA "EGGS", "$", "THERE IS A LARGE NEST HERE, FULL OF GOLDEN EGGS!"
DATA "FOOD", "-", "THERE IS A PACKAGE OF FOOD HERE."
DATA "GOBLET", "$", "THERE IS A JEWELED GOBLET HERE."
DATA "HONEY", "-", "THERE IS A JAR OF HONEY HERE."
DATA "ITEM", "$", "A NONDESCRIPT METAL ITEM GLINTS IN THE LAMPLIGHT."
DATA "JEWELRY", "$", "THERE IS PRECIOUS JEWELRY HERE."
DATA "KEYS", "%", "THERE ARE A SET OF KEYS ON THE GROUND HERE."
DATA "LAMP", "!", "THERE IS A SHINY BRASS LAMP NEARBY."
DATA "MIRROR", "%", "THERE IS AN ANTIQUE HAND MIRROR, GOOD WORKMANSHIP, BUT IT'S NOT VALUABLE."
DATA "NUGGET", "$", "THERE IS A LARGE SPARKLING NUGGET OF GOLD HERE."
DATA "OIL", "-", "THERE IS A SMALL VIAL OF OIL HERE."
DATA "PERSIAN RUG", "$", "THERE IS A PERSIAN RUG SPREAD OUT ON THE FLOOR!"
DATA "QUARTZ", "$", "A QUARTZ CRYSTAL AMONGST THE RUBBLE HERE REFRACTS THE LIGHT OF YOUR LAMP."
DATA "ROD", "%", "A THREE FOOT BLACK ROD WITH A RUSTY STAR ON AN END LIES NEARBY."
DATA "SPELLBOOK", "-", "THERE IS A SPELLBOOK HERE, WITH MYSTERIOUS, UNREADABLE RUNES ON ITS COVER."
DATA "TRIDENT", "$", "THERE IS A JEWEL-ENCRUSTED TRIDENT HERE."
DATA "UMBRELLA", "+", "AN UMBRELLA HAS BEEN LEFT OPEN TO DRY HERE."
DATA "VASE", "$", "THERE IS A DELICATE, PRECIOUS, MING VASE HERE!"
DATA "WATER BOTTLE", "-", "THERE IS A FULL WATER BOTTLE HERE."
DATA "ZINE", "-", "HERE IS A RECENT ISSUE OF THE 'ZINE 'SPELUNKER TODAY'."
REM END OF OBJECTS
DATA "["

COMMANDS:
REM THE HEART OF THE ADVENTURE IS IN THE INDIVIDUAL COMMANDS
REM ACTION, OBJECT, LOCATION, TRANSFORMED OBJECT, TRANSFORMED LOCATION
REM E.G., "USE", "JEWEL", "TRL", "A NOW PALE JEWEL LIES HERE.", "TRX: THERE IS A STATUE OF A TROLL HERE. PATHS LEAD IN ALL DIRECTIONS.", "THE JEWEL SHINES AS BRIGHT AS THE MORNING SUN. THE TROLL CRIES OUT IN FEAR, AND TURNS TO STONE."
REM - ACTION: CAN WRITE JUST THE FIRST LETTER, THOUGH IT IS MORE READABLE TO INCLUDE THE WORD; MANDATORY
REM - OBJECT: CAN WRITE JUST THE FIRST LETTER… IF THE OBJECT DOESN’T MATTER, USE "*"
REM - LOCATION: THE 3-LETTER NAME OF A LOCATION; IF AN ACTION APPLIES ANYWHERE, USE "***"
REM - TRANSFORMED OBJECT
REM -- "DRO" TO DROP THE OBJECT, "TAK" TO TAKE IT, "RMV" TO REMOVE IT FROM THE GAME
REM -- "XYZ:" TO MOVE THE OBJECT TO THE SPECIFIED LOCATION
REM -- "XYZ: THE BOTTLE IS NOW EMPTY." TO MODIFY THE DESCRIPTION OF THE OBJECT
REM - TRANSFORMED LOCATION
REM -- THE FIRST THREE LETTERS EITHER GIVE A NEW NAME TO THE LOCATION (USEFUL FOR AVOIDING FIRING COMMANDS THAT NO LONGER APPLY) OR REUSE THE ORIGINAL NAME
REM -- THE DESCRIPTION CAN BE REVISED TO SHOW THE IMPACT OF AN ACTION; A NEW PATH IS SET FROM KEYWORDS "NORTH", "SOUTH", "EAST", "WEST" OR "ALL DIRECTIONS"
REM DEFINE THE NUMBER OF COMMANDS
CMNDMAX = 99
DATA "CLOSE", "CHEST", "***", "A CLOSED TREASURE CHEST IS HERE.", "", "IT CREAKS SHUT."
DATA "CLOSE", "OIL", "***", "", "", "THE STENCH WAS MAKING ME LIGHTHEADED."
DATA "CLOSE", "UMBRELLA", "***", "A CLOSED UMBRELLA LIES ON THE GROUND.", "", "IT WILL NEVER DRY OUT LIKE THAT."
DATA "DROP", "FOOD", "MAZ", "RMV", "MAZ: YOU ARE IN A MAZE OF TWISTY LITTLE PASSAGES, ALL DIFFERENT THANKS TO YOUR TRAIL OF BREADCRUMBS.", "THE RATIONS CONTAIN SOME STALE BREAD, WHICH YOU TEAR OFF AND DROP TO CREATE A TRAIL OF BREADCRUMBS TO FIND YOUR WAY THROUGH THE MAZE."
DATA "DROP", "MIRROR", "***", "THERE IS A CRACKED HAND MIRROR HERE.", "", "THE MIRROR CRACKED. THE WORKMANSHIP WASN'T AS GOOD AS I THOUGHT. I WAS RIGHT THAT IT'S NOT VALUABLE. IS THAT STILL SEVEN YEARS BAD LUCK?"
DATA "DROP", "VASE", "SFT", "", "", "THE MING VASE DROPS GENTLY ONTO THE THICK PILE CARPET."
DATA "DROP", "VASE", "***", "THE FLOOR IS LITTERED WITH LARGE WORTHLESS SHARDS OF POTTERY.", "", "THE MING VASE DROPS WITH A DELICATE CRASH."
DATA "FIGHT", "*", "BEA", "", "", "WITH WHAT? YOUR BARE HANDS? AGAINST *HIS* BEAR HANDS??"
DATA "FIGHT", "*", "CLM", "", "", "THE SHELL IS VERY STRONG AND IS IMPERVIOUS TO ATTACK."
DATA "FIGHT", "*", "DOR", "", "", "YOU HURT YOUR HANDS. THE DOOR WINS THIS ROUND."
DATA "FIGHT", "*", "DRG", "", "", "YOUR BLOWS BOUNCE HARMLESSLY OFF THE DRAGON'S THICK SCALES."
DATA "FIGHT", "*", "DWA", "", "", "YOU ATTACK A LITTLE DWARF, BUT HE DODGES OUT OF THE WAY."
DATA "FIGHT", "*", "DWF", "", "", "THE DWARF RETREATS, THEN PUNCHES YOU."
DATA "FIGHT", "*", "DWR", "", "", "THE THREATENING LITTLE DWARF WON'T LET YOU STAY IN THIS ROOM."
DATA "FIGHT", "*", "GIA", "", "", "FIGHT A GIANT? YOU DON'T KNOW JACK."
DATA "FIGHT", "*", "GRT", "", "", "YOU LOSE, AFTER A GRATE FIGHT."
DATA "FIGHT", "*", "PIR", "", "", "SHIVER ME TIMBERS!' HE CRIES, 'I'LL CUT OFF YOUR HAND UNLESS YOU GIVE ME WHAT I WANT!'"
DATA "FIGHT", "*", "REP", "", "", "LET SLEEPING DWARVES LIE."
DATA "FIGHT", "*", "SNK", "", "", "ATTACKING THE SNAKE BOTH DOESN'T WORK AND IS VERY DANGEROUS."
DATA "FIGHT", "*", "TRL", "", "", "TROLLS ARE CLOSE RELATIVES WITH THE ROCKS AND HAVE SKIN AS TOUGH AS THAT OF A RHINOCEROS. THE TROLL FENDS OFF YOUR BLOWS EFFORTLESSLY."
DATA "FIGHT", "*", "WIZ", "", "", "YOU ARE ENGULFED IN A CLOUD OF ORANGE SMOKE, COUGHING AND GASPING."
DATA "GIVE", "*", "BEA", "", "", "THE BEAR IS CONFUSED; SHE ONLY WANTS TO BE YOUR FRIEND."
DATA "GIVE", "*", "CLM", "DRO", "", "OK, BUT I IMAGINE THIS WILL JUST IRRITATE THE CLAM."
DATA "GIVE", "*", "DWA", "RMV", "", "DWARVES ARE GREEDY. THEY'LL TAKE ANYTHING YOU GIVE THEM."
DATA "GIVE", "*", "DWF", "RMV", "", "DWARVES ARE GREEDY. THEY'LL TAKE ANYTHING YOU GIVE THEM."
DATA "GIVE", "*", "DWR", "RMV", "", "DWARVES ARE GREEDY. THEY'LL TAKE ANYTHING YOU GIVE THEM."
DATA "GIVE", "*", "GTO", "DRO", "", "ONE-EYED WILLIE HAS BEEN EXPECTING YOU."
DATA "GIVE", "LAMP", "***", "TAK", "", "I APPRECIATE YOUR ENLIGHTENED NATURE, BUT YOU CAN'T GET FAR WITHOUT IT."
DATA "GIVE", "*", "PLT", "TAK", "", "EVEN TALKING PLANTS AREN'T MATERIALISTIC."
DATA "GIVE", "*", "REP", "TAK", "", "ACTUALLY, IT SEEMS LIKE NOTHING WILL WAKE THEM."
DATA "GIVE", "*", "REP", "", "", "YOU PROD THE NEAREST DWARF, WHO WAKES UP GRUMPILY, TAKES ONE LOOK AT YOU, CURSES, AND GRABS FOR HIS AXE."
DATA "GIVE", "*", "SNK", "DRO", "", "THE SNAKE HISSES AT YOU."
DATA "GIVE", "*", "WIZ", "TAK", "", "THE WIZARD IS NOT INTERESTED IN THE THINGS OF PETTY MORTALS. OR MUGGLES."
DATA "GIVE", "%", "GIA", "TAK", "", "THE GIANT HAS NO USE FOR TINY OBJECTS MADE FOR TINY HANDS."
DATA "GIVE", "$", "DRG", "RMV", "", "THE DRAGON'S HOARD CAN NEVER BE TOO FULL."
DATA "GIVE", "$", "GIA", "RMV", "", "THE GIANT LOVES TREASURE."
DATA "GIVE", "$", "PIR", "MAZ:", "", "THE PIRATE WILL GLADLY SHAKE YOUR BOOTY."
DATA "GIVE", "$", "TRL", "RMV", "TRL: A RICKETY WOODEN BRIDGE EXTENDS ACROSS* A CHASM, VANISHING INTO THE MIST. A SIGN POSTED ON THE BRIDGE READS, 'STOP! PAY TROLL!' THE @TROLL STANDS BY THE BRIDGE AND INSISTS YOU THROW HIM *ANOTHER* TREASURE BEFORE YOU MAY CROSS.", "THE TROLL CATCHES YOUR TREASURE AND SCURRIES AWAY OUT OF SIGHT."
DATA "GIVE", "AXE", "DWF", "RMV", "DWX: YOU ARE IN A LONG SLOPING NORTH/EAST CORRIDOR WITH RAGGED SHARP WALLS.", "THE DWARF TAKES THE AXE AND THROWS IT AT YOU FOR GOOD MEASURE. WHEN IT BOOMERANGS BACK TO HIM, HE SMILES AND LEAVES."
DATA "GIVE", "AXE", "TRL", "TAK", "", "THE TROLL DEFTLY CATCHES THE AXE, EXAMINES IT CAREFULLY, AND TOSSES IT BACK, DECLARING, 'GOOD WORKMANSHIP, BUT IT'S NOT VALUABLE ENOUGH.'"
DATA "GIVE", "BIRDCAGE", "SNK", "RMV", "", "THE SNAKE HAS NOW DEVOURED YOUR BIRD."
DATA "GIVE", "CHEST", "PIR", "MAZ:", "MZE: A NARROW CRAWL LEADS DOWN INTO A MAZE OF TWISTY LITTLE PASSAGES, ALL ALIKE. YOU CAN EXIT TO THE EAST.", "'I'D BEST HIE MESELF OFF TO THE MAZE TO HIDE ME TREASURE!' WITH THAT, HE VANISHES INTO THE GLOOM."
DATA "GIVE", "EGGS", "GIA", "RMV", "GNT: YOU ARE IN THE GIANT ROOM. THE CEILING HERE IS TOO HIGH UP FOR YOUR LAMP TO SHOW IT. CAVERNOUS PASSAGES LEAD EAST, NORTH, AND SOUTH.", "'FEE-FIE-FOE-FATCH. I CANNOT WAIT UNTIL THESE EGGS HATCH.' HE GOES OFF IN SEARCH OF A NEST."
DATA "GIVE", "FOOD", "BEA", "RMV", "", "THE FEROCIOUS CAVE BEAR EAGERLY WOLFS DOWN YOUR FOOD."
DATA "GIVE", "FOOD", "DRG", "TAK", "", "THERE'S NOTHING HERE IT WANTS TO EAT (EXCEPT PERHAPS YOU)."
DATA "GIVE", "FOOD", "DWA", "TAK", "", "YOU FOOL, DWARVES EAT ONLY COAL! NOW YOU'VE MADE HIM *REALLY* MAD!!"
DATA "GIVE", "FOOD", "DWF", "TAK", "", "YOU FOOL, DWARVES EAT ONLY COAL! NOW YOU'VE MADE HIM *REALLY* MAD!!"
DATA "GIVE", "FOOD", "DWR", "TAK", "", "YOU FOOL, DWARVES EAT ONLY COAL! NOW YOU'VE MADE HIM *REALLY* MAD!!"
DATA "GIVE", "FOOD", "PLT", "TAK", "", "IT'S NOT PLANT FOOD."
DATA "GIVE", "FOOD", "TRL", "TAK", "", "GLUTTONY IS NOT ONE OF THE TROLL'S VICES. AVARICE, HOWEVER, IS."
DATA "GIVE", "GOBLET", "DRG", "RMV", "DCY: YOU ARE IN A SECRET CANYON WHICH EXITS TO THE NORTH AND EAST. YOU SEE IN THE DUST THE TRACES FROM THE HUGE GREEN DRAGON AS IT CRAWLED AWAY.", "THE GREEN GREAT DRAGON CLUTCHES THE JEWELED CUP CAREFULLY IN BOTH OF ITS CLAWS AND CRAWLS AWAY."
DATA "GIVE", "HONEY", "BEA", "RMV", "BEA: YOU ARE STANDING AT THE ENTRANCE TO A LARGE, BARREN ROOM. A SIGN POSTED ABOVE THE ENTRANCE READS: 'CAUTION! BEAR IN ROOM!' THERE IS A TAME BEAR IN THE ROOM. YOU MAY EXIT WEST.", "THE BEAR EAGERLY WOLFS DOWN YOUR FOOD, AFTER WHICH HE SEEMS TO CALM DOWN CONSIDERABLY AND EVEN BECOMES RATHER SWEET."
DATA "GIVE", "MIRROR", "DWR", "RMV", "DWM: YOU'RE IN A LONG EAST/WEST CORRIDOR.", "THE DWARF STOPS TO ADMIRE ITSELF, ALLOWING YOU TO PASS."
DATA "GIVE", "OIL", "PLT", "TAK", "", "THE PLANT INDIGNANTLY SHAKES THE OIL OFF ITS LEAVES AND ASKS, 'WATER?'"
DATA "GIVE", "ZINE", "DWA", "RMV", "DWZ: YOU ARE IN A LONG WINDING CORRIDOR SLOPING OUT OF SIGHT TO BOTH THE NORTH AND SOUTH.", "THE DWARF HAS NO ISSUE WITH THE GIFT, AND EXAMINES IT CLOSELY WHILE YOU PASS IT BY."
DATA "HELP", "*", "MAZ", "", "", "YOU CAN MAKE THE PASSAGES LOOK LESS ALIKE BY DROPPING THINGS."
DATA "OPEN", "BIRDCAGE", "SNK", "", "KNG: YOU ARE IN THE HALL OF THE MOUNTAIN KING, WITH PASSAGES OFF IN ALL DIRECTIONS.", "THE LITTLE BIRD ATTACKS THE GREEN SNAKE, AND IN AN ASTOUNDING FLURRY DRIVES THE SNAKE AWAY."
DATA "OPEN", "BIRDCAGE", "DRG", "RMV", "", "THE LITTLE BIRD ATTACKS THE GREEN DRAGON, AND IN AN ASTOUNDING FLURRY GETS BURNT TO A CINDER. THE ASHES BLOW AWAY."
DATA "OPEN", "CHEST", "***", "AN EMPTY TREASURE CHEST IS HERE.", "", "IT IS EMPTY, WHICH EXPLAINS WHY IT IS SO LIGHT."
DATA "OPEN", "OIL", "***", "", "", "THE SMELL IS UNPLEASANT."
DATA "OPEN", "SPELLBOOK", "***", "", "", "ORANGE SMOKE WAFTS FROM ITS PAGES."
DATA "OPEN", "SPELLBOOK", "WIZ", "RND:", "EER: YOU'RE IN A SMALL CHAMBER LIT BY AN EERIE GREEN LIGHT. AN EXTREMELY NARROW TUNNEL EXITS TO THE WEST. A DARK CORRIDOR LEADS NORTH.", "HE FIXES YOU WITH A STEELY GLARE, TAKES THE BOOK, AND READS ALOUD FROM THE OPENED PAGE. HE THEN MAKES A SINGLE PASS OVER YOU WITH HIS HANDS. YOU FALL INTO AN ENCHANTED SLEEP. A LONG TIME PASSES. WHEN YOU WAKE, YOU ARE COLD AND STIFF."
DATA "OPEN", "UMBRELLA", "***", "THE UMBRELLA HAS BEEN LEFT OPEN TO DRY HERE.", "", "MAYBE IT WILL DRY FASTER."
DATA "OPEN", "WATER BOTTLE", "***", "", "", "YOU HAVE TAKEN A DRINK FROM THE WATER BOTTLE. THE WATER TASTES STRONGLY OF MINERALS, BUT IS NOT UNPLEASANT. IT IS EXTREMELY COLD."
DATA "OPEN", "ZINE", "***", "", "", "I'M AFRAID THE MAGAZINE IS WRITTEN IN DWARVISH."
DATA "READ", "AXE", "***", "", "", "I RECOGNIZE THESE RUNES. THEY'RE DWARVISH."
DATA "READ", "BIRDCAGE", "***", "", "", "IT SAYS, 'I KNOW WHY THE CAGED BIRD SINGS.'"
DATA "READ", "CHEST", "***", "", "", "LETTERS ARE SCRATCHED INTO THE WOOD: 'DEAD MEN TELL NO TALES.'"
DATA "READ", "EGGS", "***", "", "", "A BOX WITHOUT HINGES, KEY, OR LID' IS THE OLD RIDDLE BUT I DON'T SEE ANYTHING WRITTEN ON THESE, AFTER TAKING A LONG GANDER."
DATA "READ", "FOOD", "***", "", "", "IT SAYS, 'RATIONS.'"
DATA "READ", "GOBLET", "***", "", "", "IT HAS OLD ENGLISH RUNES, LIKE SOMETHING OUT OF 'BEOWULF.'"
DATA "READ", "HONEY", "***", "", "", "NOTHING IS WRITTEN ON IT. POOH! SOMEONE HAS BEEN EATING IT."
DATA "READ", "ITEM", "***", "", "", "IT SAYS 'ACME' - COULD BE THE COMPANY OR IT COULD BE FROM THE HALLS OF THE MOUNTAIN KING, KING ACME."
DATA "READ", "LAMP", "***", "", "", "'D CELL BATTERIES REQUIRED.' YOUR LAMP IS GETTING DIM, AND YOU'RE OUT OF SPARE BATTERIES. YOU'D BEST START WRAPPING THIS UP."
DATA "READ", "ROD", "***", "", "", "SAYS 'MAGIC WORD XYZZY'."
DATA "READ", "SPELLBOOK", "***", "", "", "THIS AT LEAST ISN'T WRITTEN IN DWARVISH. BUT IT IS SO BORING IT COULD PUT ANYONE TO SLEEP."
DATA "READ", "SPELLBOOK", "REP", "", "WIN:", "AN ORANGE SMOKE RISES AND WAFTS AWAY THE GREEN VAPOR. THE DWARVES STIR AND WAKEN. YOU BROKE THE WIZARD'S SPELL! THE CHEERING BAND OF NOW FRIENDLY DWARVES CARRY YOU OFF INTO THE SUNSET. YOU WIN--HAIL THE CONQUERING ADVENTURER!"
DATA "READ", "TRIDENT", "***", "", "", "'4 OUT OF 5 DENTISTS SURVEYED RECOMMEND SUGARLESS GUM FOR PEARLY WHITE TEETH.' ACTUALLY, NOTHING'S WRITTEN ON IT."
DATA "READ", "ZINE", "***", "", "", "I'M AFRAID THE MAGAZINE IS WRITTEN IN DWARVISH. THE TITLE I CAN MAKE OUT: IT IS 'SPELUNKER TODAY'. OR MAYBE IT IS 'THE NEW ZORK TIMES'?"
REM DATA "TAKE", "EGGS", "***", "THERE ARE GOLDEN EGGS HERE.", "", "OK, BUT NOW THE NEST THAT WAS HOLDING THE GOLDEN EGGS HAS VANISHED!"
DATA "USE", "FOOD", "MAZ", "RMV", "MAZ: YOU ARE IN A MAZE OF TWISTY LITTLE PASSAGES, ALL DIFFERENT THANKS TO YOUR TRAIL OF BREADCRUMBS.", "THE RATIONS CONTAIN SOME STALE BREAD, WHICH YOU USE TO CREATE A TRAIL OF BREADCRUMBS TO FIND YOUR WAY THROUGH THE MAZE."
DATA "USE", "FOOD", "***", "RMV", "", "THANK YOU, IT WAS DELICIOUS!"
DATA "USE", "ITEM", "***", "", "", "USE IT FOR WHAT?! I HAVE NO IDEA WHAT IT IS. DO YOU?"
DATA "USE", "KEY", "***", "", "", "I DON'T KNOW HOW TO LOCK OR UNLOCK SUCH A THING."
DATA "USE", "KEY", "DOR", "", "", "EACH OF THE KEYS IS MUCH TOO SMALL FOR THIS LOCK. YOU CAN MOVE THE DOOR A BIT. ARE YOU EVEN SURE IT IS LOCKED?"
DATA "USE", "KEY", "GRT", "", "GRT: THE OLD IRON GRATE HAS BEEN UNLOCKED. YOU CAN SHIMMY THROUGH AND THEN DOWN IN ALL DIRECTIONS.", "THE GRATE IS NOW UNLOCKED. YOU CAN SHIMMY THROUGH AND THEN DOWN IN ANY DIRECTION."
DATA "USE", "LAMP", "***", "", "", "RUBBING THE ELECTRIC LAMP IS NOT PARTICULARLY REWARDING. ANYWAY, NOTHING EXCITING HAPPENS."
DATA "USE", "LAMP", "DRK", "", "", "CONGRATULATIONS ON BRINGING LIGHT INTO THE DARK-ROOM!"
DATA "USE", "OIL", "DOR", "", "DOR: YOU ARE AT ONE END OF AN IMMENSE NORTH/SOUTH PASSAGE. A MASSIVE, RUSTY, IRON DOOR STANDS AJAR.", "THE OIL HAS FREED UP THE HINGES SO THAT THE DOOR WILL NOW MOVE, ALTHOUGH IT REQUIRES SOME EFFORT."
DATA "USE", "PERSIAN RUG", "CHA", "RMV", "CHA: A WIDE CHASM YAWNS BEFORE YOU* WITH A PATH TRACING ITS EDGE, TO THE SOUTH AND WEST. THE PERSIAN RUG HOVERS NEARBY AND WILL SHUTTLE YOU ACROSS. AT LEAST, UNTIL IT DECIDES TO SEE A WHOLE NEW WORLD.", "IT EFFORTLESSLY FLIES YOU ACROSS THE CHASM, BEFORE PLAYFULLY FLYING AROUND, STAYING OUT OF YOUR REACH. WELL, IT WAS HEAVY TO CARRY ANYWAY."
DATA "USE", "ROD", "***", "", "", "YOU SAY 'HOCUS POCUS', 'OPEN SESAME', 'ABRACADBRA', 'PLUGH', AND EVEN 'XYZZY', BUT NOTHING HAPPENS."
DATA "USE", "ROD", "FSR", "REP: A THREE FOOT BLACK ROD WITH A RUSTY MARK ON AN END LIES NEARBY.", "FSR: A CRYSTAL BRIDGE NOW SPANS THE FISSURE*, PROVIDING A NORTH/SOUTH PASSAGE. THE MIST IS QUITE THICK HERE. ", "A CRYSTAL BRIDGE NOW SPANS THE FISSURE. THE ROD - ER, MAGIC WAND, I GUESS - VANISHES IN A CLOUD OF GREASY BLACK SMOKE."
DATA "USE", "ROD", "REP", "RMV", "WIN:", "THERE IS A LOUD EXPLOSION, AND A TWENTY-FOOT HOLE APPEARS IN THE FAR WALL. YOU MARCH THROUGH THE HOLE AND FIND YOURSELF IN THE MAIN OFFICE, WHERE A CHEERING BAND OF FRIENDLY ELVES CARRY YOU OFF INTO THE SUNSET. YOU WIN--HAIL THE CONQUERING ADVENTURER!"
DATA "USE", "SPELLBOOK", "***", "", "", "DON'T! PLEASE DON'T. DON'T TURN ME INTO ANYTHING UNNATURAL."
DATA "USE", "TRIDENT", "CLM", "", "OYS: YOU'RE IN A TINY CHAMBER CARVED OUT OF SEDIMENTARY ROCK. THE FLOOR AND WALLS ARE LITTERED WITH BITS OF SHELLS IMBEDDED IN THE STONE. A SHALLOW PASSAGE PROCEEDS WEST, AND A SOMEWHAT STEEPER ONE LEADS EAST. A LOW HANDS AND KNEES PASSAGE ENTERS FROM THE SOUTH.", "A GLISTENING PEARL FALLS OUT OF THE CLAM AND ROLLS AWAY. GOODNESS, THIS MUST REALLY BE AN OYSTER. (I NEVER WAS VERY GOOD AT IDENTIFYING BIVALVES.) WHATEVER IT IS, IT IS NOW FOLLOWING THE PEARL. YOU CAN PASS."
DATA "USE", "UMBRELLA", "***", "", "", "IT'S DAMP HERE, BUT IT IS NOT THAT DAMP. OR WERE YOU THINKING YOU'D FLOAT UP OUT OF THE CAVE?"
DATA "USE", "UMBRELLA", "WFL", "", "WFL: THE TORRENTIAL WATERFALL BLOCKS A NARROW ARCHWAY*, POURING INTO AND ECHOING DOWN A DEEP CRACK.", "THE UMBRELLA PROTECTS YOU, BUT THE FOOTING IS SLIPPERY AND TREACHEROUS. YOU PASS THROUGH SAFELY."
DATA "USE", "WATER BOTTLE", "***", "THERE IS AN ALMOST FULL WATER BOTTLE HERE.", "", "YOU HAVE TAKEN A SIP FROM THE WATER BOTTLE. THE WATER TASTES STRONGLY OF MINERALS, BUT IS NOT UNPLEASANT. IT IS EXTREMELY COLD."
DATA "USE", "WATER", "PLT", "THERE IS AN EMPTY WATER BOTTLE HERE.", "PLT: THE FLOOR HERE IS LITTERED WITH THIN ROCK SLABS AROUND A LARGE PIT. THERE ARE HOLES ALL OVER, BUT TOO HIGH UP ABOVE THE PIT, WHERE YOU CAN'T GET TO THEM. THERE IS A HUGE BEANSTALK GROWING OUT OF THE PIT UP TO THE HOLES, PROVIDING EXITS IN ALL DIRECTIONS.", "THE PLANT SPURTS INTO FURIOUS GROWTH FOR A FEW SECONDS. THERE IS A 12-FOOT-TALL BEANSTALK STRETCHING UP OUT OF THE PIT, BELLOWING 'WATER! WATER!'"
DATA "WEST", "*", "DED", "", "", "DON'T GO WEST, YOUNG MAN. DON'T GO WEST."
DATA "["

RETURN